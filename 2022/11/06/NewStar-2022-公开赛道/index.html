

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/banner/piano_man.png">
  <link rel="icon" href="/banner/piano_man.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="lanpesk">
  <meta name="keywords" content="">
  
    <meta name="description" content="第一周在忙保研的事情所以没打。现在发现第一周的题都没法交了，就从第二周的开始写了。">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStar 2022 公开赛道">
<meta property="og:url" content="http://example.com/2022/11/06/NewStar-2022-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93/index.html">
<meta property="og:site_name" content="lanpesk">
<meta property="og:description" content="第一周在忙保研的事情所以没打。现在发现第一周的题都没法交了，就从第二周的开始写了。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-11-06T04:31:03.000Z">
<meta property="article:modified_time" content="2022-11-06T04:37:15.920Z">
<meta property="article:author" content="lanpesk">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="writeup">
<meta property="article:tag" content="Crypto">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary_large_image">
  
  
  <title>NewStar 2022 公开赛道 - lanpesk</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>lanpesk</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://s2.loli.net/2022/05/01/YwbfzI9vkWMaVc2.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="NewStar 2022 公开赛道">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-11-06 12:31" pubdate>
        2022年11月6日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  

  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">NewStar 2022 公开赛道</h1>
            
            <div class="markdown-body">
              <p>第一周在忙保研的事情所以没打。现在发现第一周的题都没法交了，就从第二周的开始写了。</p>
<span id="more"></span>
<p>算是我打过比较顺的一个CTF了，对我的水平来说刚刚好，赞一个。</p>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="affine"><a class="markdownIt-Anchor" href="#affine"></a> Affine</h3>
<p>加密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>a = getPrime(<span class="hljs-number">8</span>)<br>b = getPrime(<span class="hljs-number">8</span>)<br><br>ciphertext = []<br><br><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> flag:<br>    ciphertext.append((a*f + b) % <span class="hljs-number">0x100</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>(ciphertext))<br></code></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">b</span><span class="hljs-string">&quot;\xb1<span class="hljs-char escape_">\x83</span><span class="hljs-char escape_">\x82</span>T<span class="hljs-char escape_">\x10</span><span class="hljs-char escape_">\x80</span>\xc9O<span class="hljs-char escape_">\x84</span>\xc9&lt;\x0f\xf2<span class="hljs-char escape_">\x82</span>\x9a\xc9\x9b8&#x27;\x9b&lt;\xdb\x9b\x9b<span class="hljs-char escape_">\x82</span>\xc8\xe0V&quot;</span><br></code></pre></td></tr></table></figure>
<p>a,b的大小很小，直接爆破即可。简单的仿射变换。只需要计算一下a的逆即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> base64<br><br>data = <span class="hljs-string">b&quot;\xb1\x83\x82T\x10\x80\xc9O\x84\xc9&lt;\x0f\xf2\x82\x9a\xc9\x9b8&#x27;\x9b&lt;\xdb\x9b\x9b\x82\xc8\xe0V&quot;</span><br><br>prime_set = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">7</span>, <span class="hljs-number">2</span>**<span class="hljs-number">8</span>-<span class="hljs-number">1</span>):<br>    <span class="hljs-keyword">if</span> isPrime(i):<br>        prime_set.append(i)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">data, a, b, m</span>) :<br>    <span class="hljs-keyword">try</span>:<br>        a_ = inverse(a,m)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">b&quot;&quot;</span><br>    plaintext = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>        plaintext.append(((i-b)*a_) % m)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(plaintext)<br><br><span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> itertools.product(*(prime_set,prime_set)):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>(decode(data, param[<span class="hljs-number">0</span>], param[<span class="hljs-number">1</span>], <span class="hljs-number">0x100</span>))) &lt; <span class="hljs-number">35</span>:<br>        <span class="hljs-built_in">print</span>(decode(data, param[<span class="hljs-number">0</span>], param[<span class="hljs-number">1</span>], <span class="hljs-number">0x100</span>))<br><br><span class="hljs-comment"># b&#x27;flag&#123;Kn0wn_p1aint3xt_4ttack&#125;&#x27;</span><br><span class="hljs-comment"># b&#x27;V\\QWk;^ g^O`!QY^d#hdO$ddQS[m&#x27;</span><br><br><span class="hljs-comment"># flag&#123;Kn0wn_p1aint3xt_4ttack&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="unusual_base"><a class="markdownIt-Anchor" href="#unusual_base"></a> unusual_base</h3>
<p>加密代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> shuffle<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> ascii_lowercase, ascii_uppercase, digits<br><br>alphabet = ascii_uppercase + ascii_lowercase + digits +<span class="hljs-string">&#x27;$&amp;&#x27;</span><br>alphabet = <span class="hljs-built_in">list</span>(alphabet)<br>bits = <span class="hljs-string">&#x27;&#x27;</span><br>pad_len = <span class="hljs-built_in">len</span>(flag) % <span class="hljs-number">3</span><br><br><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> flag:<br>            bits += <span class="hljs-built_in">bin</span>(f)[<span class="hljs-number">2</span>:].rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;0&#x27;</span>)<br>bits += <span class="hljs-string">&#x27;0000&#x27;</span>*pad_len<br>encoded = <span class="hljs-string">&#x27;&#x27;</span><br>shuffle(alphabet)<br>alphabet = <span class="hljs-string">&quot;&quot;</span>.join(alphabet)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(bits), <span class="hljs-number">6</span>):<br>    encoded += alphabet[<span class="hljs-built_in">int</span>(bits[i:i+<span class="hljs-number">6</span>], <span class="hljs-number">2</span>)]<br>encoded += <span class="hljs-string">&#x27;%&#x27;</span>*pad_len<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;encoded = &quot;<span class="hljs-subst">&#123;encoded&#125;</span>&quot;&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;alphabet = &quot;<span class="hljs-subst">&#123;alphabet&#125;</span>&quot;&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">encoded</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;GjN3G$B3de58ym&amp;7wQh9dgVNGQhfG2hndsGjlOyEdaxRFY%&quot;</span><br><span class="hljs-attribute">alphabet</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;c5PKAQmgI&amp;qSdyDZYCbOV2seXGloLwtFW3f9n7j481UMHBp6vNETRJa$rxuz0hik&quot;</span><br></code></pre></td></tr></table></figure>
<p>alphabet的长度是64，所以是base64换表，这里这个百分号要去掉。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> b2s<br><br>str1 = <span class="hljs-string">&quot;GjN3G$B3de58ym&amp;7wQh9dgVNGQhfG2hndsGjlOyEdaxRFY&quot;</span><br>char_set = <span class="hljs-string">&quot;c5PKAQmgI&amp;qSdyDZYCbOV2seXGloLwtFW3f9n7j481UMHBp6vNETRJa$rxuz0hik&quot;</span><br><br>data = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> str1:<br>    data += <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(char_set.rfind(i))[<span class="hljs-number">2</span>:]).zfill(<span class="hljs-number">6</span>)<br><br>data = data[:(<span class="hljs-built_in">len</span>(data)//<span class="hljs-number">8</span>)*<span class="hljs-number">8</span>]<br><span class="hljs-built_in">print</span>(b2s(data))<br><br><span class="hljs-comment"># b&#x27;flag&#123;a1ph4bet_c0u1d_be_d1ffi3r3nt&#125;&#x27;</span><br><br><span class="hljs-comment"># flag&#123;a1ph4bet_c0u1d_be_d1ffi3r3nt&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="robot"><a class="markdownIt-Anchor" href="#robot"></a> robot</h3>
<p>加密脚本与输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br><br>cipher = []<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun1</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> sha256(x.encode()).hexdigest()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun2</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(<span class="hljs-number">114514</span>,<span class="hljs-built_in">ord</span>(x),<span class="hljs-number">1919810</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun3</span>(<span class="hljs-params">x</span>):<br>    key = random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">1145141919810</span>)<br>    ans = x.encode()<br>    <span class="hljs-keyword">if</span> key &amp; <span class="hljs-number">1</span>:<br>        ans = b32encode(ans)<br>    key &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> key &amp; <span class="hljs-number">1</span>:<br>        ans = b64encode(ans)<br>    key &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> key &amp; <span class="hljs-number">1</span>:<br>        ans = b16encode(ans)<br>    key &gt;&gt;= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> ans<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">msg</span>):<br>    res = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> msg:<br>        tmp = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(random.choice([fun1,fun2,fun3]),[i]))[<span class="hljs-number">0</span>]<br>        res.append(tmp)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-built_in">print</span>(encrypt(flag))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">[&#x27;252f10c83610ebca1a059c0bae8255eba2f95be4d1d7bcfa89d7248a82d9f111&#x27;, 1495846, 1452754, b&#x27;M4======&#x27;, &#x27;021fb596db81e6d02bf3d2586ee3981fe519f275c0ac9ca76bbcf2ebb4097d96&#x27;, &#x27;2e7d2c03a9507ae265ecf5b5356885a53393a2029d241394997265a1a25aefc6&#x27;, &#x27;4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a&#x27;, b&#x27;Tg==&#x27;, &#x27;1b16b1df538ba12dc3f97edbb85caa7050d46c148134290feba80f8236c83db9&#x27;, b&#x27;52304539505430395054303D&#x27;, &#x27;e3b98a4da31a127d4bde6e43033f66ba274cab0eb7eb1c70ec41402bf6273dd8&#x27;, b&#x27;58773D3D&#x27;, &#x27;3f39d5c348e5b79d06e842c114e6cc571583bbf44e4b0ebfda1a01ec05745d43&#x27;, &#x27;4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce&#x27;, &#x27;2e7d2c03a9507ae265ecf5b5356885a53393a2029d241394997265a1a25aefc6&#x27;, b&#x27;T0k9PT09PT0=&#x27;, &#x27;18f5384d58bcb1bba0bcd9e6a6781d1a6ac2cc280c330ecbab6cb7931b721552&#x27;, b&#x27;T0E9PT09PT0=&#x27;, 825026, &#x27;d2e2adf7177b7a8afddbc12d1634cf23ea1a71020f6a1308070a16400fb68fde&#x27;, 1455816, b&#x27;4F553D3D3D3D3D3D&#x27;, 1165366, 1242964, b&#x27;4F493D3D3D3D3D3D&#x27;, 652094, 597296, &#x27;4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce&#x27;, &#x27;4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a&#x27;, b&#x27;54314539505430395054303D&#x27;, 1242964, 368664, b&#x27;TVU9PT09PT0=&#x27;, b&#x27;cw==&#x27;, 1602214]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>根据每一项的类型进行爆破即可，也就base那边麻烦点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><br>data = ...<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generateHashMap</span>():<br>    <span class="hljs-keyword">return</span> &#123;sha256(x.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)).hexdigest():x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ascii_letters + digits + <span class="hljs-string">&quot;&#123;&#125;_&quot;</span>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generateDiscreteLog</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-built_in">pow</span>(<span class="hljs-number">114514</span>,<span class="hljs-built_in">ord</span>(x),<span class="hljs-number">1919810</span>):x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> ascii_letters + digits + <span class="hljs-string">&quot;&#123;&#125;_&quot;</span>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generateBaseEncode</span>():<br>    res = &#123;&#125;<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ascii_letters + digits + <span class="hljs-string">&quot;&#123;&#125;_&quot;</span>:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            tmp = i.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>            <span class="hljs-keyword">if</span> j &amp; <span class="hljs-number">1</span>:<br>                tmp = b32encode(tmp)<br>            <span class="hljs-keyword">if</span> (j &gt;&gt; <span class="hljs-number">1</span>) &amp; <span class="hljs-number">1</span>:<br>                tmp = b64encode(tmp)<br>            <span class="hljs-keyword">if</span> (j &gt;&gt; <span class="hljs-number">2</span>) &amp; <span class="hljs-number">1</span>:<br>                tmp = b16encode(tmp)<br><br>            res[tmp] = i<br>    <span class="hljs-keyword">return</span> res<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params">unit</span>):<br>    hashMap = generateHashMap()<br>    DiscreteLog = generateDiscreteLog()<br>    BaseEncode = generateBaseEncode()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(unit) <span class="hljs-keyword">is</span> <span class="hljs-built_in">str</span>:<br>        <span class="hljs-keyword">return</span> hashMap[unit]<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(unit) <span class="hljs-keyword">is</span> <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">return</span> DiscreteLog[unit]<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(unit) <span class="hljs-keyword">is</span> <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">return</span> BaseEncode[unit]<br><br>res = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>    res.append(decode(i))<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(res))<br><br><span class="hljs-comment"># flag&#123;c4Nn0t_D3crYpt_buT_r3p34t_Yes&#125;</span><br></code></pre></td></tr></table></figure>
<p>代码写的烂，但我不想改。反正也不是什么太大运算量。</p>
<h3 id="ezrabin"><a class="markdownIt-Anchor" href="#ezrabin"></a> ezRabin</h3>
<p>加密脚本与输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> somewhere_you_do_not_know <span class="hljs-keyword">import</span> flag<br><span class="hljs-comment">#flag格式为 flag&#123;XXXX&#125;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ezprime</span>(<span class="hljs-params">n</span>):<br>    p=getPrime(n)<br>    <span class="hljs-keyword">while</span> p%<span class="hljs-number">4</span>!=<span class="hljs-number">3</span>:<br>        p=getPrime(n)<br>    <span class="hljs-keyword">return</span> p<br>p=ezprime(<span class="hljs-number">512</span>)<br>q=ezprime(<span class="hljs-number">512</span>)<br>n=p*q<br>m=bytes_to_long(flag)<br>m=(m&lt;&lt;(<span class="hljs-number">300</span>))+getRandomNBitInteger(<span class="hljs-number">300</span>)<br><span class="hljs-keyword">assert</span> m**<span class="hljs-number">2</span>&gt;n <span class="hljs-keyword">and</span> m&lt;n<br>c=<span class="hljs-built_in">pow</span>(m,<span class="hljs-number">4</span>,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;c=&#x27;</span>,c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;p=&#x27;</span>,p)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;q=&#x27;</span>,q)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">c= 59087040011818617875466940950576089096932769518087477304162753047334728508009365510335057824251636964132317478310267427589970177277870220660958570994888152191522928881774614096675980017700457666192609573774572571582962861504174396725705862549311100229145101667835438230371282904888448863223898642183925834109</span><br><span class="hljs-string">p= 10522889477508921233145726452630168129218487981917965097647277937267556441871668611904567713868254050044587941828674788953975031679913879970887998582514571</span><br><span class="hljs-string">q= 11287822338267163056031463255265099337492571870189068887689824393221951058498526362126606231275830844407608185240702408947800715624427717739233431252556379</span><br><span class="hljs-string">就要花里胡哨（</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>这里Rabin其实就是e=2的RSA，但这里他用的e是4，所以解两个Rabin即可。一层rabin有4个解，所以两层就有16个解，从里面找有意义的即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>c= ...<br>p= ...<br>q= ...<br>n = p*q<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Rabin_decrypt</span>(<span class="hljs-params">c, p, q</span>) :<br>    n = p*q<br>    m_p = <span class="hljs-built_in">pow</span>(c, (p+<span class="hljs-number">1</span>)//<span class="hljs-number">4</span>, p)<br>    m_q = <span class="hljs-built_in">pow</span>(c, (q+<span class="hljs-number">1</span>)//<span class="hljs-number">4</span>, q)<br><br>    _, y_p, y_q = gcdext(p, q)<br><br>    m = []<br>    m.append((y_p*p*m_q + y_q*q*m_p)%n)<br>    m.append(n - m[-<span class="hljs-number">1</span>])<br>    m.append((y_p*p*m_q - y_q*q*m_p) % n)<br>    m.append(n - m[-<span class="hljs-number">1</span>])<br><br>    <span class="hljs-keyword">return</span> m<br><br><br>res = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> Rabin_decrypt(c,p,q):<br>    res += Rabin_decrypt(i,p,q)<br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res:<br>    <span class="hljs-built_in">print</span>(n2s(<span class="hljs-built_in">int</span>(i &gt;&gt; <span class="hljs-number">300</span>)))<br>    <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">...</span><br><span class="hljs-string">b&#x27;flag&#123;R4bin_3ncrypti0n_with_3_mod_4_is_two_e4sy&#125;&#x27;</span><br><span class="hljs-string">...</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># flag&#123;R4bin_3ncrypti0n_with_3_mod_4_is_two_e4sy&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="ezprng"><a class="markdownIt-Anchor" href="#ezprng"></a> ezPRNG</h3>
<p>加密脚本与输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>flag = <span class="hljs-string">b&#x27;xxxxxxxxxxxxxxxxxxxx&#x27;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">my_prng_lcg</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, seed, multiplier, increment, modulus</span>):<br>        self.state = seed<br>        self.multiplier = multiplier<br>        self.increment = increment<br>        self.modulus = modulus<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">random</span>(<span class="hljs-params">self</span>):<br>        self.state = (self.state * self.multiplier + self.increment) % self.modulus<br>        <span class="hljs-keyword">return</span> self.state<br><br>PRNG = my_prng_lcg(bytes_to_long(flag), getRandomInteger(<span class="hljs-number">256</span>), getRandomInteger(<span class="hljs-number">256</span>), getRandomInteger(<span class="hljs-number">256</span>))<br>gift = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    gift.append(PRNG.random())<br><br>qwq = bytes_to_long(flag)<br><span class="hljs-built_in">print</span>(qwq.bit_length())<br><span class="hljs-built_in">print</span>(gift)<br><span class="hljs-comment"># [32579077549265101609729134002322479188058664203229584246639330306875565342934, 30627296760863751873213598737521260410801961411772904859782399797798775242121, 59045755507520598673072877669036271379314362490837080079400207813316110037822, 29714794521560972198312794885289362350476307292503308718904661896314434077717, 3378007627369454232183998646610752441039379051735310926898417029172995488622, 35893579613746468714922176435597562302206699188445795487657524606666534642489]</span><br></code></pre></td></tr></table></figure>
<p>这题直接套脚本就行了，很标准的LCG题。</p>
<p>如果想要看原理的，这里https://www.dazhuanlan.com/oec2003/topics/1015881或者https://blog.csdn.net/superprintf/article/details/108964563。有些文章我也不知道他们是从哪里搬的，所以我没法给出最初的原网址，这里见谅。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> n2s<br><br>Xn = ...<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_modulus</span>(<span class="hljs-params">states</span>):<br>    diffs = [s1 - s0 <span class="hljs-keyword">for</span> s0, s1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(states, states[<span class="hljs-number">1</span>:])]<br>    zeroes = [t2*t0 - t1*t1 <span class="hljs-keyword">for</span> t0, t1, t2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(diffs, diffs[<span class="hljs-number">1</span>:], diffs[<span class="hljs-number">2</span>:])]<br>    modulus = <span class="hljs-built_in">abs</span>(reduce(gcd, zeroes))<br>    <span class="hljs-keyword">return</span> crack_unknown_multiplier(states, modulus)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_multiplier</span>(<span class="hljs-params">states, modulus</span>):<br>    multiplier = (states[<span class="hljs-number">2</span>] - states[<span class="hljs-number">1</span>]) * inverse(states[<span class="hljs-number">1</span>] - states[<span class="hljs-number">0</span>], modulus) % modulus<br>    <span class="hljs-keyword">return</span> crack_unknown_increment(states, modulus, multiplier)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_increment</span>(<span class="hljs-params">states, modulus, multiplier</span>):<br>    increment = (states[<span class="hljs-number">1</span>] - states[<span class="hljs-number">0</span>]*multiplier) % modulus<br>    <span class="hljs-keyword">return</span> modulus, multiplier, increment<br><br>n,a,b = crack_unknown_modulus(Xn)<br><br>m = (Xn[<span class="hljs-number">0</span>] - b)*inverse(a, n) % n<br><span class="hljs-built_in">print</span>(n2s(m))<br><br><br><span class="hljs-comment"># b&#x27;flag&#123;lcG_1s_s0_34sy&#125;&#x27;</span><br><br><span class="hljs-comment"># flag&#123;lcG_1s_s0_34sy&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="prof-shamirs-secret"><a class="markdownIt-Anchor" href="#prof-shamirs-secret"></a> Prof. Shamir’s Secret</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br>a = getPrime(<span class="hljs-number">256</span>)<br>b = getPrime(<span class="hljs-number">256</span>)<br>c = getPrime(<span class="hljs-number">256</span>)<br>d = bytes_to_long(flag)<br>n = getStrongPrime(<span class="hljs-number">2048</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">poly</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> (a * x ** <span class="hljs-number">3</span> + b * x ** <span class="hljs-number">2</span> + c * x + d) % n<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>    x = getRandomNBitInteger(<span class="hljs-number">256</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;(<span class="hljs-subst">&#123;x&#125;</span>, <span class="hljs-subst">&#123;poly(x)&#125;</span>)&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(n)<br></code></pre></td></tr></table></figure>
<p>看到这个多项式还有shamir，一眼秘密共享。</p>
<p>输出给了4项，可以直接重构多项式。</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>1</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>1</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>2</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>2</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>3</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>3</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>3</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>4</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>4</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>4</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mtext>   </mtext><mi>Y</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">M = 
\begin{pmatrix}
1 \ x_1 \ x_1^2 \ x_1^3 \\
1 \ x_2 \ x_2^2 \ x_2^3 \\
1 \ x_3 \ x_3^2 \ x_3^3 \\
1 \ x_4 \ x_4^2 \ x_4^3 \\
\end{pmatrix} ,  \ \ \ 
Y = 
\begin{pmatrix}
res_1 \\ res_2 \\ res_3 \\ res_4
\end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>那么即有：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>1</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>1</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>1</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>2</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>2</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>2</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>3</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>3</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>3</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mtext> </mtext><msub><mi>x</mi><mn>4</mn></msub><mtext> </mtext><msubsup><mi>x</mi><mn>4</mn><mn>2</mn></msubsup><mtext> </mtext><msubsup><mi>x</mi><mn>4</mn><mn>3</mn></msubsup></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>d</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>r</mi><mi>e</mi><msub><mi>s</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix}
1 \ x_1 \ x_1^2 \ x_1^3 \\
1 \ x_2 \ x_2^2 \ x_2^3 \\
1 \ x_3 \ x_3^2 \ x_3^3 \\
1 \ x_4 \ x_4^2 \ x_4^3 \\
\end{pmatrix} 
\begin{pmatrix}
d \\ c \\ b \\ a
\end{pmatrix}
=
\begin{pmatrix}
res_1 \\ res_2 \\ res_3 \\ res_4
\end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4518920000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24810799999999997em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">d</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">c</span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">b</span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.80006em;vertical-align:-2.15003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em;"><span style="top:-4.8100000000000005em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500299999999997em;"><span style="top:-1.6499900000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.805em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.4050100000000003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em;"><span class="pstrut" style="height:3.1550000000000002em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>所以我们构造出矩阵然后求解即可，这里的d就是我们的flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># sage</span><br>n = ...<br><br>x1, res1 = ...<br>x2, res2 = ...<br>x3, res3 = ...<br>x4, res4 = ...<br><br>x = [x1, x2, x3, x4]<br>y = [res1, res2, res3, res4]<br>M = Matrix(GF(n), <span class="hljs-number">4</span>, <span class="hljs-number">4</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(x)):<br>        M[i,j] = x[i]**j<br>        <br>Y = vector(GF(n), y)<br><br>res = M.solve_right(Y)<br><br><span class="hljs-built_in">print</span>(n2s(<span class="hljs-built_in">int</span>(res[<span class="hljs-number">0</span>])))<br><br><span class="hljs-comment"># b&#x27;flag&#123;w0w_y0u_k0nw_sham1r_s3cret_5h4r1ng_4nd_1agrange_interpolation!!!&#125;&#x27;</span><br><br><span class="hljs-comment"># flag&#123;w0w_y0u_k0nw_sham1r_s3cret_5h4r1ng_4nd_1agrange_interpolation!!!&#125;</span><br></code></pre></td></tr></table></figure>
<p>下面是加密脚本的输出：</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clojure">(<span class="hljs-number">107156592202708719207677242145785380370925248573491581679548864240229105117413</span><span class="hljs-punctuation">,</span> <span class="hljs-number">130345771647598884054430192964980389494531690916321281560051538057910945565624075918097771618618910263287152864051564635195578796179646674192491555857366963976329072793625649841007238934532144994966695961491116944111900519450656607199501654544809304677384301432194356761274376314501143216649135187625964931902</span>)<br>(<span class="hljs-number">90629424458637844580841178302065768114471702341586161908858665404968070428143</span><span class="hljs-punctuation">,</span> <span class="hljs-number">78858394764644720845979385422903377630845158220853604360871859882044655577246282808874532941560824773914594412415345616068416548364923695233972936176087206729847544516343237888024173952758718279163069742944961359652574962129434781851767007643037433981750489254639449637677610354746497770492254725894119193662</span>)<br>(<span class="hljs-number">100626477579781167218124067468465940736522526684796828200460725563611057086831</span><span class="hljs-punctuation">,</span> <span class="hljs-number">107938673826832098883774065383352754899611421173786919174851524067358319831595518533880365335333592351382030254987030861475878447430100862628809476494215295084769705787398168068863060859122952000010558086859754975554734850230223040925027217057055876423229204027280075168615462165634569977166298865366648414270</span>)<br>(<span class="hljs-number">93935717805931479760310332373603550626215862380271563609987050092246456803681</span><span class="hljs-punctuation">,</span> <span class="hljs-number">87807687834883656794449107852803757931909462710953942209358337840912886376275257864214018767300085688088981183791568376874906785193974861264511995029891797395218085734556515485224508250678274640400740193260888803386269425525930551167801371074041851406813322268615707951973495879968706624649318162995708734670</span>)<br><span class="hljs-number">31332583438236375592937719796184754941510418106758544436807128579095975774977164550965999210436423180868482749439792419270701760326867558983833590368116755394302102816558834270767750410927007254951332459412016857259923960095221831744199277859298274645778838122123090174549834537459028702418645316659860963695912411044490603690484176741018002722235584411422885336520840416125528921196994346534698226763483608314982898155320734426983215291745003213365884087604024203316024824786079501166114638727651689476288442288919373885358425210859822108037791909364199015379638899887715692181883916583183449343868694265742569597579</span><br></code></pre></td></tr></table></figure>
<h3 id="keyexchange"><a class="markdownIt-Anchor" href="#keyexchange"></a> keyExchange</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag, gb, g, p, Diffie_Hellman_KEY_EXCHANGE<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><br>plaintext = pad(flag, <span class="hljs-number">16</span>)<br><br>a = getRandomNBitInteger(<span class="hljs-number">1024</span>)<br>shared = Diffie_Hellman_KEY_EXCHANGE(a) <span class="hljs-comment"># the original one, not the elliptic curve version!!!!</span><br>key = md5(<span class="hljs-built_in">str</span>(shared).encode()).digest()<br><br>cipher = AES.new(key, AES.MODE_ECB)<br>ciphertext = cipher.encrypt(plaintext)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;师傅给你送了一个flag&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;加密的flag = <span class="hljs-subst">&#123;b64encode(ciphertext)&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;p = <span class="hljs-subst">&#123;p&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;your secret key <span class="hljs-subst">&#123;a&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;g = <span class="hljs-subst">&#123;g&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;师傅的公钥 = <span class="hljs-subst">&#123;gb&#125;</span>&#x27;</span>)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">师傅给你送了一个flag</span><br><span class="hljs-string">加密的flag = b&#x27;w8OCrexPPqnv2hR+xKeHhXIp0Blp1DYCV4LeZeeLpv5MzUL71raTOeOs4SQBySHH&#x27;</span><br><span class="hljs-string">p = 133448764119399847876731592238604881175769007976799828874328988761588128500145459082023001027383524831194316266946485380737147372837136403065060245135035225976604193830121124575947440188318348815263642243784574567832213775382081426762862856428888257126982268557543952549848053225651398101391048467656128070913</span><br><span class="hljs-string">your secret key 141940531741414073502483547551457269459744373002985569536254444581939073930343975447649087549033350166772929396986965301002444997704537487577508504709368627174241095027876996113941220579274986994026832534664179333669861059196192190040046004398523932288881838011696679341328520530265002776147308306715042734185</span><br><span class="hljs-string">g = 3</span><br><span class="hljs-string">师傅的公钥 = 89434791765835058026108803508194156525355359465406829253856379139334424137549915669535243140614128105195584073112084994777148895681804127886440617684648237403345873311011154293855911891719204975035914932661810961867593769891076834656437254428353814290948181922438812745384577094827728409350756648446941874382</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<p>DH密钥分配协议，这个比赛倒是复习了不少现代密码学。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>data = b64decode(<span class="hljs-string">b&#x27;w8OCrexPPqnv2hR+xKeHhXIp0Blp1DYCV4LeZeeLpv5MzUL71raTOeOs4SQBySHH&#x27;</span>)<br><br>p = ...<br>s = ... (your secret key )<br>g = <span class="hljs-number">3</span><br>pk = ...<br><br>secret = <span class="hljs-built_in">pow</span>(pk, s, p)<br><br>key = md5(<span class="hljs-built_in">str</span>(secret).encode()).digest()<br><br>decoder = AES.new(key, AES.MODE_ECB)<br><span class="hljs-built_in">print</span>(decoder.decrypt(data))<br><br><span class="hljs-comment"># b&#x27;flag&#123;d1ff1e_h311m4n_is_4_p13c3_0f_c4k3&#125;\t\t\t\t\t\t\t\t\t&#x27;</span><br><span class="hljs-comment"># flag&#123;d1ff1e_h311m4n_is_4_p13c3_0f_c4k3&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="one-time-pad"><a class="markdownIt-Anchor" href="#one-time-pad"></a> One Time Pad</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> xor<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> ascii_lowercase<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> keylength<br><span class="hljs-keyword">import</span> random<br>key = []<br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(keylength):<br>    key.append(random.choice(ascii_lowercase.encode()))<br><br>key = <span class="hljs-built_in">bytes</span>(key)<br><br>plaintext = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;books.txt&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>).read()<br><br>ciphertext = xor(plaintext, key)<br><span class="hljs-built_in">print</span>(key)<br><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;encrypted_book&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>).write(ciphertext)<br></code></pre></td></tr></table></figure>
<p>题目给了三个文件，一个是这个加密用的文件，一个是一个Kasiski test文件，这个是用来做词频分析用的。加密的文件是encrypted book。这说明这是一本书，所以其中的信息是有意义的，也就暗示我们用词频分析来破解这个一次一密。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;encrypted_book&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> fp:<br>    data = fp.read()<br><br>gift_from_sias27.kasiski_test(data)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">你查完资料了吗?</span><br><span class="hljs-string">(Y/N) &gt; y</span><br><span class="hljs-string">key length:    5 with probability 0.5880384087791495</span><br><span class="hljs-string">key length:   10 with probability 0.14260631001371743</span><br><span class="hljs-string">...</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<p>所以这里密钥的长度我们选择5。随后来爆破密钥。这里我用的是permutations，但实际上应该要product。因为product数据集比较大，我就先想着用小一点的能不能跑出来，毕竟26选5，选出全不一样的概率还是挺大的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> gift_from_sias27<br><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> strxor<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;encrypted_book&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> fp:<br>    data = fp.read()<br><br><span class="hljs-comment"># gift_from_sias27.kasiski_test(data)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> itertools.permutations(ascii_lowercase, <span class="hljs-number">5</span>):<br>    key = (<span class="hljs-string">&quot;&quot;</span>.join(i).encode(<span class="hljs-string">&quot;utf-8&quot;</span>)*(<span class="hljs-built_in">len</span>(data)//<span class="hljs-number">5</span> + <span class="hljs-number">1</span>))[:<span class="hljs-built_in">len</span>(data)]<br>    res = strxor(key, data)<br>    <span class="hljs-keyword">if</span> res.decode(<span class="hljs-string">&quot;utf-8&quot;</span>).isprintable() <span class="hljs-keyword">and</span> <span class="hljs-string">b&quot;flag&#123;&quot;</span> <span class="hljs-keyword">in</span> res:<br>        <span class="hljs-built_in">print</span>(res)<br>        <br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur? Sic secretum dabo tibi: flag&#123;frequency_analysis_could_be_useful#A6DC1D643A29&#125;. At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti quos dolores et quas molestias excepturi sint occaecati cupiditate non provident, similique sunt in culpa qui officia deserunt mollitia animi, id est laborum et dolorum fuga. Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio cumque nihil impedit quo minus id quod maxime placeat facere possimus, omnis voluptas assumenda est, omnis dolor repellendus. Temporibus autem quibusdam et aut officiis debitis aut rerum necessitatibus saepe eveniet ut et voluptates repudiandae sint et molestiae non recusandae. Itaque earum rerum hic tenetur a sapiente delectus, ut aut reiciendis voluptatibus maiores alias consequatur aut perferendis doloribus asperiores repellat. &#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># flag&#123;frequency_analysis_could_be_useful#A6DC1D643A29&#125;</span><br></code></pre></td></tr></table></figure>
<p>这里我们不要用pwntools里面的xor，太慢了。</p>
<p>不过他这个给的Kasiski test脚本吗，好东西，我留着了。</p>
<h3 id="aes"><a class="markdownIt-Anchor" href="#aes"></a> AES?</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> b2a_hex<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> s2n<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_to_16</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)) % <span class="hljs-number">16</span>:<br>        add = <span class="hljs-number">16</span> - (<span class="hljs-built_in">len</span>(text.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)) % <span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">else</span>:<br>        add = <span class="hljs-number">0</span><br>    text = text + (<span class="hljs-string">&#x27;\0&#x27;</span> * add)<br>    <span class="hljs-keyword">return</span> text.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>():<br>    r1 = getrandbits(<span class="hljs-number">64</span>)<br>    r2 = getrandbits(<span class="hljs-number">32</span>)<br>    m = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(r1).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    salt = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(r2).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    m += salt<br>    <span class="hljs-keyword">return</span> add_to_16(m.decode())<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">m, key, iv</span>):<br>    mode = AES.MODE_CBC<br>    cryptos = AES.new(key, mode, iv)<br>    cipher_text = cryptos.encrypt(m)<br>    <span class="hljs-keyword">return</span> cipher_text<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chall</span>(<span class="hljs-params">key, iv</span>):<br>    old_m = init()<br>    c = encrypt(old_m, key, iv)<br>    <span class="hljs-keyword">return</span> b2a_hex(c)<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;msg.txt&quot;</span>, <span class="hljs-string">&#x27;w+&#x27;</span>)<br>    old_key = <span class="hljs-string">b&#x27;73E5602B54FE63A5&#x27;</span><br>    old_iv = <span class="hljs-string">b&#x27;B435AE462FBAA662&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">208</span>):<br>        old_c = chall(old_key, old_iv)<br>        f.write(<span class="hljs-string">&quot;&#123;&#125;\n&quot;</span>.<span class="hljs-built_in">format</span>(old_c.decode()))<br><br>    salt = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(getrandbits(<span class="hljs-number">32</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    m = flag.encode() + salt<br>    key = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(getrandbits(<span class="hljs-number">64</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    iv = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(getrandbits(<span class="hljs-number">64</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    c = encrypt(add_to_16(m.decode()), key, iv)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c = %r&quot;</span>%(b2a_hex(c)))<br><br><span class="hljs-comment"># c = b&#x27;c82dc20b7512d03f1a0982eb8a6e855db20f6fe3ff8d202a6fb74c6522fa6e623c6abe6725cafe78f9624ad59f3e90af6f985f38f75ec4d62ff7e02bd7c2f051&#x27;</span><br></code></pre></td></tr></table></figure>
<p>输出的文件给了很多数据。emm，给这么多数据总感觉有种PRNG的感觉。百度了一下getrandbits确实有这个伪随机数生成的问题。所以可以解。可以看这个文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_62506844/article/details/124278580">https://blog.csdn.net/m0_62506844/article/details/124278580</a></p>
<p>但是反解出来的随机数数据有点麻烦。他这个16进制化并不满足偶数字节，我们也可以不管这个我问题，因为我们使用拟合的方式，有些点在外面其实没啥问题。但是这个里面存在错误的数已经达到了63个，这就有点多了…没有办法做到完全预测。我们需要降低这个错误的数字数量。这题考的点竟在如何处理数据上面…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&quot;msg.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> fp:<br>    data = fp.read().splitlines()<br>    data = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(binascii.unhexlify, data))<br><br>old_key = <span class="hljs-string">b&#x27;73E5602B54FE63A5&#x27;</span><br>old_iv = <span class="hljs-string">b&#x27;B435AE462FBAA662&#x27;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypted</span>(<span class="hljs-params">data, key, iv</span>):<br>    decoder = AES.new(key, AES.MODE_CBC, iv)<br>    m = decoder.decrypt(data)<br>    <span class="hljs-keyword">return</span> m<br><br><br>m = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>    m.append(decrypted(i,old_key,old_iv).replace(<span class="hljs-string">b&quot;\x00&quot;</span>, <span class="hljs-string">b&quot;&quot;</span>))<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(m)):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(m[i]) != <span class="hljs-number">24</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(m[i]) == <span class="hljs-number">22</span>:<br>            tmp = <span class="hljs-string">b&quot;0&quot;</span> + m[i][:<span class="hljs-number">15</span>] + <span class="hljs-string">b&quot;0&quot;</span> + m[i][<span class="hljs-number">15</span>:]<br>            m[i] = <span class="hljs-built_in">int</span>(tmp,<span class="hljs-number">16</span>)<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(m[i])== <span class="hljs-number">23</span>:<br>            tmp = []<br>            tmp.append(<span class="hljs-built_in">int</span>(<span class="hljs-string">b&quot;0&quot;</span> + m[i],<span class="hljs-number">16</span>))<br>            tmp.append(<span class="hljs-built_in">int</span>(m[i][:<span class="hljs-number">15</span>] + <span class="hljs-string">b&quot;0&quot;</span> + m[i][<span class="hljs-number">15</span>:], <span class="hljs-number">16</span>))<br>            m[i] = tmp<br>    <span class="hljs-keyword">else</span>:<br>        m[i] = <span class="hljs-built_in">int</span>(m[i], <span class="hljs-number">16</span>)<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(m)):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(m[i]) == <span class="hljs-built_in">int</span>:<br>        m[i] = [m[i]]<br><br><br><span class="hljs-keyword">for</span> seq <span class="hljs-keyword">in</span> itertools.product(*m):<br>    rc = RandCrack()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> seq:<br>        num_64 = i &gt;&gt; <span class="hljs-number">32</span><br>        num_32 = i &amp; <span class="hljs-number">2</span>**<span class="hljs-number">32</span> -<span class="hljs-number">1</span><br>        rc.submit(num_64 &amp; <span class="hljs-number">2</span>**<span class="hljs-number">32</span> -<span class="hljs-number">1</span>)<br>        rc.submit(num_64 &gt;&gt; <span class="hljs-number">32</span>)<br>        rc.submit(num_32)<br><br>    flag = binascii.unhexlify(<span class="hljs-string">b&#x27;c82dc20b7512d03f1a0982eb8a6e855db20f6fe3ff8d202a6fb74c6522fa6e623c6abe6725cafe78f9624ad59f3e90af6f985f38f75ec4d62ff7e02bd7c2f051&#x27;</span>)<br>    salt = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(rc.predict_getrandbits(<span class="hljs-number">32</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    key = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(rc.predict_getrandbits(<span class="hljs-number">64</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    iv = <span class="hljs-string">&quot;&#123;:X&#125;&quot;</span>.<span class="hljs-built_in">format</span>(rc.predict_getrandbits(<span class="hljs-number">64</span>)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    decoder = AES.new(key, AES.MODE_CBC, iv)<br>    res = decoder.decrypt(flag)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;flag&quot;</span> <span class="hljs-keyword">in</span> res:<br>        <span class="hljs-built_in">print</span>(res)<br>        exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-comment"># b&#x27;flag&#123;7h7gi3nl-ald4ssf8-eajfwm7t-rujquhmg&#125;4AF4B023\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span><br><br><span class="hljs-comment"># flag&#123;7h7gi3nl-ald4ssf8-eajfwm7t-rujquhmg&#125;</span><br></code></pre></td></tr></table></figure>
<p>还好跑出来了。</p>
<h3 id="lcg-revenge"><a class="markdownIt-Anchor" href="#lcg-revenge"></a> LCG Revenge</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG<br>p = getPrime(<span class="hljs-number">128</span>)<br>step = <span class="hljs-built_in">len</span>(FLAG) // <span class="hljs-number">3</span><br>xs = [bytes_to_long(FLAG[:step]), bytes_to_long(FLAG[step:<span class="hljs-number">2</span>*step]), bytes_to_long(FLAG[<span class="hljs-number">2</span>*step:])]<br>a = getPrime(<span class="hljs-number">64</span>)<br>b = getPrime(<span class="hljs-number">64</span>)<br>c = getPrime(<span class="hljs-number">64</span>)<br>a = <span class="hljs-number">18038175596386287827</span><br>b = <span class="hljs-number">15503291946093443851</span><br>c = <span class="hljs-number">17270168560153510007</span><br>p = <span class="hljs-number">307956849617421078439840909609638388517</span><br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    new_state = (a*xs[<span class="hljs-number">0</span>] + b*xs[<span class="hljs-number">1</span>] + c*xs[<span class="hljs-number">2</span>]) % p<br>    xs = xs[<span class="hljs-number">1</span>:] + [new_state]<br>    <span class="hljs-comment">#print(xs)</span><br><span class="hljs-built_in">print</span>(xs)<br><span class="hljs-built_in">print</span>(a, b, c, p)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[255290883651191064919890629542861653873, 221128501895959214555166046983862519384, 108104020183858879999084358722168548984]</span><br><span class="hljs-string">18038175596386287827 15503291946093443851 17270168560153510007 307956849617421078439840909609638388517</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>
<p>很简单的一个递推序列，直接往前解就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>xs = [<span class="hljs-number">255290883651191064919890629542861653873</span>, <span class="hljs-number">221128501895959214555166046983862519384</span>, <span class="hljs-number">108104020183858879999084358722168548984</span>]<br>a,b,c,p = <span class="hljs-number">18038175596386287827</span>, <span class="hljs-number">15503291946093443851</span>, <span class="hljs-number">17270168560153510007</span>, <span class="hljs-number">307956849617421078439840909609638388517</span><br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    pre_state = (((xs[-<span class="hljs-number">1</span>] - b*xs[<span class="hljs-number">0</span>] - c*xs[<span class="hljs-number">1</span>]) % p)*inverse(a, p))%p<br>    xs = [pre_state] + xs[:-<span class="hljs-number">1</span>]<br><br><span class="hljs-built_in">print</span>(xs)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">b&quot;&quot;</span>.join(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(long_to_bytes, xs))))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[8114814712001258480140047838565, 7560227278457332921618993210722, 9062145970196464608031907603837]</span><br><span class="hljs-string">b&#x27;flag&#123;try_some_linear_algebra_technique&#125;&#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># flag&#123;try_some_linear_algebra_technique&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="代数关系"><a class="markdownIt-Anchor" href="#代数关系"></a> 代数关系</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br>p = getStrongPrime(<span class="hljs-number">2048</span>)<br>q = getStrongPrime(<span class="hljs-number">2048</span>)<br>n = p*q<br>phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>e1 = getPrime(<span class="hljs-number">16</span>)<br>e2 = getPrime(<span class="hljs-number">16</span>)<br>e3 = getPrime(<span class="hljs-number">16</span>)<br>d1 = inverse(e1, phi)<br>d2 = inverse(e2, phi)<br>d3 = inverse(e3, phi)<br>gift_from_fallwind = d2 - d1<br>sp = <span class="hljs-built_in">len</span>(flag) // <span class="hljs-number">3</span><br>m1 = bytes_to_long(flag[<span class="hljs-number">0</span>:sp])<br>m2 = bytes_to_long(flag[sp: <span class="hljs-number">2</span>*sp])<br>m3 = bytes_to_long(flag[<span class="hljs-number">2</span>*sp:])<br><br>c1= <span class="hljs-built_in">pow</span>(m1, e1, n)<br>c2= <span class="hljs-built_in">pow</span>(m2, e2, n)<br>c3= <span class="hljs-built_in">pow</span>(m3, e3, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;n = <span class="hljs-subst">&#123;n&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;e1 = <span class="hljs-subst">&#123;e1&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;e2 = <span class="hljs-subst">&#123;e2&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;e3 = <span class="hljs-subst">&#123;e3&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c1 = <span class="hljs-subst">&#123;c1&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c2 = <span class="hljs-subst">&#123;c2&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c3 = <span class="hljs-subst">&#123;c3&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;gift_from_fallwind = <span class="hljs-subst">&#123;gift_from_fallwind&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p>这里数据就不放了。</p>
<p>这题怎么说呢，我好像写了一部分非预期…我也顺便把我的非预期解说一下吧，虽然这个非预期只能解前两段。</p>
<p>给了一个gift，这个挺有用的，这里我们将gift简写为g。我们可以得到：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>d</mi><mn>2</mn></msub><mo>−</mo><msub><mi>d</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>e</mi><mn>1</mn></msub><mo>=</mo><msub><mi>e</mi><mn>1</mn></msub><msub><mi>d</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>g</mi><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>d</mi><mn>2</mn></msub><mo>−</mo><msub><mi>d</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub><msub><mi>d</mi><mn>1</mn></msub><mspace linebreak="newline"></mspace><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><msub><mi>d</mi><mn>2</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><msub><mi>d</mi><mn>1</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mi>e</mi><mn>1</mn><mo>−</mo><mi>e</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">ge_1 = (d_2 -d_1)e_1 = e_1d_2 -1 \\
ge_2 = (d_2 -d_1)e_2 = 1 -e_2d_1 \\
ge_1e_2 = d_2e_1e_2 - d_1e_1e_2 = e1 - e2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">e</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathdefault">e</span><span class="mord">2</span></span></span></span></span></p>
<p>那么对于第一段密文和第二段密文我们有:</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>c</mi><mn>1</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>2</mn></msub></mrow></msubsup><mo>=</mo><msubsup><mi>m</mi><mn>1</mn><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub></mrow></msubsup><mo>⇒</mo><msubsup><mi>m</mi><mn>1</mn><msub><mi>e</mi><mn>2</mn></msub></msubsup><mo>=</mo><mo stretchy="false">(</mo><msubsup><mi>c</mi><mn>1</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn></mrow></msubsup><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mspace linebreak="newline"></mspace><msubsup><mi>c</mi><mn>2</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub></mrow></msubsup><mo>=</mo><msubsup><mi>m</mi><mn>2</mn><mrow><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub></mrow></msubsup><mo>⇒</mo><msubsup><mi>m</mi><mn>2</mn><msub><mi>e</mi><mn>1</mn></msub></msubsup><mo>=</mo><msubsup><mi>c</mi><mn>2</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn></mrow></msubsup></mrow><annotation encoding="application/x-tex">c_1^{ge_2} = m_1^{e_1-e_2} \Rightarrow m_1^{e_2} = (c_1^{ge_2 - 1})^{-1}\\
c_2^{ge_1} = m_2^{e_1-e_2} \Rightarrow m_2^{e_1} = c_2^{ge_1 + 1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0486079999999998em;vertical-align:-0.266308em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7822999999999999em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.180908em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1195389999999998em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8532309999999999em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.198324em;vertical-align:-0.266308em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9320159999999998em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.180908em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.0486079999999998em;vertical-align:-0.266308em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7822999999999999em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.180908em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1195389999999998em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8532309999999999em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0126em;vertical-align:-0.26630799999999993em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1449em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.26630799999999993em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.198324em;vertical-align:-0.266308em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9320159999999998em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.180908em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>那么我可以组合出两组式子：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>m</mi><mn>1</mn><msub><mi>e</mi><mn>2</mn></msub></msubsup><mo>=</mo><mo stretchy="false">(</mo><msubsup><mi>c</mi><mn>1</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn></mrow></msubsup><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>m</mi><mn>1</mn><msub><mi>e</mi><mn>1</mn></msub></msubsup><mo>=</mo><msub><mi>c</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow><mspace width="2em"/><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>m</mi><mn>2</mn><msub><mi>e</mi><mn>1</mn></msub></msubsup><mo>=</mo><msubsup><mi>c</mi><mn>2</mn><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn></mrow></msubsup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>m</mi><mn>2</mn><msub><mi>e</mi><mn>2</mn></msub></msubsup><mo>=</mo><msub><mi>c</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">\begin{cases}
		m_1^{e_2} = (c_1^{ge_2 - 1})^{-1} \\
		m_1^{e_1} = c_1
\end{cases}
\qquad
\begin{cases}
		m_2^{e_1} = c_2^{ge_1 + 1} \\
		m_2^{e_2} = c_2
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.932016em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.1449000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace" style="margin-right:2em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1449000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.932016em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.746292em;"><span style="top:-2.433692em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.1449000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.266308em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>由于e1与e2是互素的。我们可以使用共模攻击求解这两段明文。</p>
<p>但是这样的方法遇到第三段明文没辙了。需要另外找办法做。</p>
<p>注意这个式子：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><msub><mi>d</mi><mn>2</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><msub><mi>d</mi><mn>1</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mi>e</mi><mn>1</mn><mo>−</mo><mi>e</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">ge_1e_2 = d_2e_1e_2 - d_1e_1e_2 = e1 - e2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">e</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord mathdefault">e</span><span class="mord">2</span></span></span></span></span></p>
<p>这个其实有点问题，因为我们没有带上模。如果带上模的话：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><msub><mi>d</mi><mn>2</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><msub><mi>d</mi><mn>1</mn></msub><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><msub><mi>e</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>k</mi><mn>2</mn></msub><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub><mo>+</mo><mo stretchy="false">(</mo><msub><mi>e</mi><mn>1</mn></msub><msub><mi>k</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub><msub><mi>k</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>e</mi><mn>1</mn></msub><mo>−</mo><msub><mi>e</mi><mn>2</mn></msub><mo>+</mo><mi>K</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ge_1e_2 = d_2e_1e_2 - d_1e_1e_2 = e_1(1 + k_1\phi(n)) - e_2(1+k_2\phi(n))\\
ge_1e_2 = e_1 - e_2 + (e_1k_1 - e_2k_2)\phi(n) = e_1 - e_2 + K\phi(n)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></p>
<p>那么：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi><msub><mi>e</mi><mn>1</mn></msub><msub><mi>e</mi><mn>2</mn></msub><mo>−</mo><msub><mi>e</mi><mn>1</mn></msub><mo>+</mo><msub><mi>e</mi><mn>2</mn></msub><mo>=</mo><mi>K</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ge_1e_2 - e_1 + e_2 = K\phi(n)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></p>
<p>好了，那么我们就可以来求d了。为什么？回顾一下RSA解密的推导：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>m</mi><mi>e</mi></msup><mo>=</mo><mi>c</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><msup><mi>m</mi><mrow><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">m^e = c \ mod \ p \\
m^{\phi(n)} = 1 \ mod \ p
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7143919999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">e</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">c</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">ϕ</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault">p</span></span></span></span></span></p>
<p>这里我们有：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>m</mi><mrow><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mn>1</mn><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><msup><mi>m</mi><mrow><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn></mrow></msup><mo>=</mo><mi>m</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mspace linebreak="newline"></mspace><mi>e</mi><mi>d</mi><mo>=</mo><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>+</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>d</mi><mo>=</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>k</mi><mi>ϕ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">m^{k\phi(n)} = 1 \ mod \ p \\
m^{k\phi(n) + 1} = m \ mod \ p \\
ed = k\phi(n) + 1 \\
d = e^{-1} \ mod \ k\phi(n)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">ϕ</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">1</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.938em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mord mathdefault mtight">ϕ</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight">n</span><span class="mclose mtight">)</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">m</span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault">p</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord mathdefault">m</span><span class="mord mathdefault">o</span><span class="mord mathdefault">d</span><span class="mspace"> </span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">ϕ</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></p>
<p>所以我们可以直接用$$K\phi(n)$$来求d，并用这个d来求解我们的明文。而且，这个也可以用来解前面两段明文。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>n = ...<br>e1 = <span class="hljs-number">42407</span><br>e2 = <span class="hljs-number">42299</span><br>e3 = <span class="hljs-number">64279</span><br>c1 = ...<br>c2 = ...<br>c3 = ...<br>gift_from_fallwind = ...<br><br><br>he1 = gift_from_fallwind*e1<br>he2 = gift_from_fallwind*e2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">common_modulus</span>(<span class="hljs-params">n, c1, c2, e1, e2</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">egcd</span>(<span class="hljs-params">a, b</span>):<br>        <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> a, <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            x, y = egcd(b, a % b)<br>            <span class="hljs-keyword">return</span> y, x - (a // b) * y<br>    s = egcd(e1, e2)<br>    s1 = s[<span class="hljs-number">0</span>]<br>    s2 = s[<span class="hljs-number">1</span>]<br><br>    <span class="hljs-keyword">if</span> s1 &lt; <span class="hljs-number">0</span>:<br>        s1 = - s1<br>        c1 = inverse(c1, n)<br>    <span class="hljs-keyword">elif</span> s2 &lt; <span class="hljs-number">0</span>:<br>        s2 = - s2<br>        c2 = inverse(c2, n)<br>    m = <span class="hljs-built_in">pow</span>(c1, s1, n) * <span class="hljs-built_in">pow</span>(c2, s2, n) % n<br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-comment"># m1</span><br><span class="hljs-comment"># exp1: m1^e1 = c1</span><br><span class="hljs-comment"># exp2: m1^e2 = c1/c1^he2</span><br><br>m1c1 = c1<br>m1c2 = inverse(<span class="hljs-built_in">pow</span>(c1,he2-<span class="hljs-number">1</span>, n), n)<br>m1e1 = e1<br>m1e2 = e2<br><span class="hljs-built_in">print</span>(long_to_bytes(common_modulus(n,m1c1,m1c2, m1e1,m1e2)))<br><br><span class="hljs-comment"># m2</span><br><span class="hljs-comment"># exp1: m2^e1 = c2^(he1+1)</span><br><span class="hljs-comment"># exp2: m2^e2 = c2</span><br><br>m2c1 = <span class="hljs-built_in">pow</span>(c2, he1+<span class="hljs-number">1</span>, n)<br>m2c2 = c2<br>m2e1 = e1<br>m2e2 = e2<br><span class="hljs-built_in">print</span>(long_to_bytes(common_modulus(n,m2c1,m2c2, m2e1,m2e2)))<br><br><span class="hljs-comment"># m3</span><br><br>t_phi = gift_from_fallwind*e1*e2 - e1 + e2<br>d3 = inverse(e3, t_phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c3, d3, n)))<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">b&#x27;flag&#123;a1g3br&#x27;</span><br><span class="hljs-string">b&#x27;4ic_re1at1o&#x27;</span><br><span class="hljs-string">b&#x27;n_i5_us3ful&#125;&#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># flag&#123;a1g3br4ic_re1at1on_i5_us3ful&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="移位与异或"><a class="markdownIt-Anchor" href="#移位与异或"></a> 移位与异或</h3>
<p>拿到的竟然是一个程序…</p>
<p>虽然最近一直在做密码学和逆向，不得不说这两个做到最后很多地方是一样的…</p>
<p>IDA打开又是没有符号表，各种流程乱的一堆，找不到关键的函数。</p>
<p>还是用动态调试看看吧。切入点是输出函数。</p>
<p>x64dbg打开，查看符号表：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">地址<span class="hljs-operator">=</span><span class="hljs-number">00007</span>FF672CD1320 类型<span class="hljs-operator">=</span>导入 符号<span class="hljs-operator">=</span>ucrtbased.strlen<br>地址<span class="hljs-operator">=</span><span class="hljs-number">00007</span>FF672CD1328 类型<span class="hljs-operator">=</span>导入 符号<span class="hljs-operator">=</span>ucrtbased.__stdio_common_vfprintf<br>地址<span class="hljs-operator">=</span><span class="hljs-number">00007</span>FF672CD1330 类型<span class="hljs-operator">=</span>导入 符号<span class="hljs-operator">=</span>ucrtbased.__acrt_iob_func<br>地址<span class="hljs-operator">=</span><span class="hljs-number">00007</span>FF672CD1338 类型<span class="hljs-operator">=</span>导入 符号<span class="hljs-operator">=</span>ucrtbased.__stdio_common_vsprintf_s<br></code></pre></td></tr></table></figure>
<p>只有这里有两个和输出相关的函数。所以通过这里打断点来看输出点在哪。<code>__stdio_common_vsprintf_s</code>这个函数断点不进入，所以断点打在了<code>__stdio_common_vfprintf</code>上，输入好启动参数。运行到我们的断点。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">RAX</span> : <span class="hljs-number">00007</span>FF672CCD190     encrypt_msvc_x86_64.<span class="hljs-number">00007</span>FF672CCD190<br><span class="hljs-attribute">RBX</span> : <span class="hljs-number">0000000000000000</span><br><span class="hljs-attribute">RCX</span> : <span class="hljs-number">0000000000000024</span>     &#x27;$&#x27;<br><span class="hljs-attribute">RDX</span> : <span class="hljs-number">00007</span>FF8EFFF7C88     ucrtbased.<span class="hljs-number">00007</span>FF8EFFF7C88<br><span class="hljs-attribute">RBP</span> : <span class="hljs-number">000000217</span>C39F450<br><span class="hljs-attribute">RSP</span> : <span class="hljs-number">000000217</span>C39F418<br><span class="hljs-attribute">RSI</span> : <span class="hljs-number">0000000000000000</span><br><span class="hljs-attribute">RDI</span> : <span class="hljs-number">000000217</span>C39F5B8<br><span class="hljs-attribute">R8</span>  : <span class="hljs-number">00007</span>FF672CCAC28     <span class="hljs-string">&quot;%016llx&quot;</span><br><span class="hljs-attribute">R9</span>  : <span class="hljs-number">0000000000000000</span><br></code></pre></td></tr></table></figure>
<p>在传入的参数中发现了&quot;%016llx&quot;。这个是传入的格式。通过这个我们能找到具体的输出点。IDA打开，在Strings视图中查找这个字符串。</p>
<p>查找这个字符串的xrefs。有一个引用，确定了。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_140011990</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, __int64 a2)</span><br>&#123;<br>  <span class="hljs-type">size_t</span> v3; <span class="hljs-comment">// rax</span><br>  __int64 v4; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+44h] [rbp+24h]</span><br><br>  sub_140011370((__int64)&amp;unk_140022015);<br>  <span class="hljs-keyword">if</span> ( a1 != <span class="hljs-number">2</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>  v5 = j_strlen(*(<span class="hljs-type">const</span> <span class="hljs-type">char</span> **)(a2 + <span class="hljs-number">8</span>));<br>  <span class="hljs-keyword">if</span> ( v5 % <span class="hljs-number">8</span> )<br>    v5 = <span class="hljs-number">8</span> * (v5 / <span class="hljs-number">8</span>) + <span class="hljs-number">8</span>;<br>  Block = <span class="hljs-built_in">malloc</span>(v5);<br>  j_memset(Block, <span class="hljs-number">0</span>, v5);<br>  v3 = j_strlen(*(<span class="hljs-type">const</span> <span class="hljs-type">char</span> **)(a2 + <span class="hljs-number">8</span>));<br>  j_memcpy(Block, *(<span class="hljs-type">const</span> <span class="hljs-type">void</span> **)(a2 + <span class="hljs-number">8</span>), v3);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; v5 / <span class="hljs-number">8</span>; ++i )<br>  &#123;<br>    v4 = sub_14001137A((__int64)Block + <span class="hljs-number">8</span> * i);<br>    sub_140011195(<span class="hljs-string">&quot;%016llx&quot;</span>, v4);<br>  &#125;<br>  <span class="hljs-built_in">free</span>(Block);<br>  sub_140011195(<span class="hljs-string">&quot;\n&quot;</span>);<br>  Block = <span class="hljs-number">0</span>i64;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>转到引用的函数。这个就是我们的加密函数了。sub_140011195就是printf，而上方的sub_14001137A应该就是加密函数。Block里面装的就是我们的输入数据。</p>
<p>进入到sub_14001137A函数，这个函数最终指向sub_1400117C0。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_1400117C0</span><span class="hljs-params">(__int64 a1)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> __int64 v2; <span class="hljs-comment">// [rsp+28h] [rbp+8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+44h] [rbp+24h]</span><br><br>  sub_140011370((__int64)&amp;unk_140022015);<br>  v2 = <span class="hljs-number">0</span>i64;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i )<br>    v2 = *(<span class="hljs-type">char</span> *)(a1 + i) + (v2 &lt;&lt; <span class="hljs-number">8</span>);<br>  <span class="hljs-keyword">return</span> qword_14001D000 ^ (v2 &gt;&gt; <span class="hljs-number">5</span>) ^ (<span class="hljs-number">8</span> * v2);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这个循环实际上就是字符串转QWORD。所以求解即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>QWORD = <span class="hljs-number">0x4472ACBF7784FF37</span><br>cipher = unhexlify(<span class="hljs-string">&quot;7422c48f97e43ff4bd326c7e36c43ff4bd421c6e26e41f2cf4eaa566e725cee4341a24e73fa4170434e944bf7784ff37&quot;</span>)<br><br>x = BitVec(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-number">64</span>)<br><br>data = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)//<span class="hljs-number">8</span>):<br>    s = Solver()<br>    block = bytes_to_long(cipher[<span class="hljs-number">8</span>*i:<span class="hljs-number">8</span>*i + <span class="hljs-number">8</span>])<br>    s.add(block == QWORD ^ (x &gt;&gt; <span class="hljs-number">5</span>) ^ (x &lt;&lt; <span class="hljs-number">3</span> &amp; <span class="hljs-number">0xffffffffffffffff</span>))<br>    <span class="hljs-keyword">if</span> s.check() == sat:<br>        res = s.model()<br>        data.append(res[x].as_long())<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">b&quot;&quot;</span>.join(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(long_to_bytes, data))))<br><br><span class="hljs-comment"># b&#x27;flag&#123;wow_wow_wow_you_solved_my_encryption&#125;\x00\x00\x00\x00\x00\x00&#x27;</span><br><br><span class="hljs-comment"># flag&#123;wow_wow_wow_you_solved_my_encryption&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="flip-flop"><a class="markdownIt-Anchor" href="#flip-flop"></a> flip-flop</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG<br>auth_major_key = os.urandom(<span class="hljs-number">16</span>)<br><br>BANNER = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Login as admin to get the flag ! </span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>MENU = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Enter your choice</span><br><span class="hljs-string">[1] Create NewStarCTF Account</span><br><span class="hljs-string">[2] Create Admin Account</span><br><span class="hljs-string">[3] Login</span><br><span class="hljs-string">[4] Exit</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-built_in">print</span>(BANNER)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-built_in">print</span>(MENU)<br><br>    option = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;&gt; &#x27;</span>))<br>    <span class="hljs-keyword">if</span> option == <span class="hljs-number">1</span>:<br>        auth_pt = <span class="hljs-string">b&#x27;NewStarCTFer____&#x27;</span><br>        user_key = os.urandom(<span class="hljs-number">16</span>)<br>        cipher = AES.new(auth_major_key, AES.MODE_CBC, user_key)<br>        code = cipher.encrypt(auth_pt)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;here is your authcode: <span class="hljs-subst">&#123;user_key.<span class="hljs-built_in">hex</span>() + code.<span class="hljs-built_in">hex</span>()&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> option == <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GET OUT !!!!!!&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> option == <span class="hljs-number">3</span>:<br>        authcode = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;Enter your authcode &gt; &#x27;</span>)<br>        user_key = <span class="hljs-built_in">bytes</span>.fromhex(authcode)[:<span class="hljs-number">16</span>]<br>        code = <span class="hljs-built_in">bytes</span>.fromhex(authcode)[<span class="hljs-number">16</span>:]<br>        cipher = AES.new(auth_major_key, AES.MODE_CBC, user_key)<br>        auth_pt = cipher.decrypt(code)<br>        <span class="hljs-keyword">if</span> auth_pt == <span class="hljs-string">b&#x27;AdminAdmin______&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(FLAG)<br>        <span class="hljs-keyword">elif</span> auth_pt == <span class="hljs-string">b&#x27;NewStarCTFer____&#x27;</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Have fun!!&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Who are you?&#x27;</span>)<br>    <span class="hljs-keyword">elif</span> option == <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ByeBye&#x27;</span>)<br>        exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;WTF&quot;</span>)<br></code></pre></td></tr></table></figure>
<p>使用的是AES的CBC模式，加上名字的flip就直到是字节反转攻击了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> strxor<br><br><br><span class="hljs-comment"># context(log_level=&#x27;debug&#x27;)</span><br>sh = remote(<span class="hljs-string">&quot;node4.buuoj.cn&quot;</span>,<span class="hljs-number">25597</span>)<br><br>sh.recvuntil(<span class="hljs-string">b&quot;&gt;&quot;</span>)<br>sh.sendline(<span class="hljs-string">b&quot;1&quot;</span>)<br>line = sh.recvline()<br>auth_code = line[line.index(<span class="hljs-string">b&quot;:&quot;</span>) + <span class="hljs-number">2</span>: -<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(auth_code)<br><br>origin = <span class="hljs-string">b&quot;NewStarCTFer____&quot;</span><br>target = <span class="hljs-string">b&quot;AdminAdmin______&quot;</span><br><br>auth_pt = binascii.unhexlify(auth_code)[:<span class="hljs-number">16</span>]<br>random_code = binascii.unhexlify(auth_code)[<span class="hljs-number">16</span>:]<br><br>new_auth_pt = strxor(auth_pt, strxor(origin, target))<br>new_auth_code = (new_auth_pt + random_code).<span class="hljs-built_in">hex</span>().encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br><span class="hljs-built_in">print</span>(new_auth_code)<br><br>sh.recvuntil(<span class="hljs-string">b&quot;&gt;&quot;</span>)<br>sh.sendline(<span class="hljs-string">b&quot;3&quot;</span>)<br>sh.sendline(new_auth_code)<br><span class="hljs-built_in">print</span>(sh.recvline())<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[x] Opening connection to node4.buuoj.cn on port 25597</span><br><span class="hljs-string">[x] Opening connection to node4.buuoj.cn on port 25597: Trying 117.21.200.166</span><br><span class="hljs-string">[+] Opening connection to node4.buuoj.cn on port 25597: Done</span><br><span class="hljs-string">b&#x27;d0b08894f8ad2bbae5877acdfd99e354e36ad068f4a1284b6f65b451fac513c1&#x27;</span><br><span class="hljs-string">b&#x27;dfb192aee28d3d94d8af40e0fd99e354e36ad068f4a1284b6f65b451fac513c1&#x27;</span><br><span class="hljs-string">b&quot; Enter your authcode &gt; b&#x27;flag&#123;filp_the_word!!!!!!!!&#125;&#x27;\n&quot;</span><br><span class="hljs-string">[*] Closed connection to node4.buuoj.cn port 25597</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># flag&#123;filp_the_word!!!!!!!!&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="an-der-schönen-elliptische-kurve"><a class="markdownIt-Anchor" href="#an-der-schönen-elliptische-kurve"></a> An der schönen Elliptische Kurve</h3>
<p>椭圆曲线的题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG, ECDH_KEY_EXCHANGE<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> urandom<br><br>iv = urandom(<span class="hljs-number">16</span>)<br><br><br>a = <span class="hljs-number">14489</span><br>b = <span class="hljs-number">10289</span><br>p = <span class="hljs-number">7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span><br><br>F = GF(p)<br>E = EllipticCurve(F, [a, b])<br><br>G = E.random_point()<br><br>my_private_key = random_prime(<span class="hljs-number">2</span>^<span class="hljs-number">256</span>)<br><br>shared, sender_public_key = ECDH_KEY_EXCHANGE(G, my_private_key)<br><br>key = md5(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared.xy()[<span class="hljs-number">0</span>])).encode()).digest()<br><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br>ciphretext = cipher.encrypt(FLAG)<br><br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-built_in">print</span>(b)<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-built_in">print</span>(sender_public_key)<br><span class="hljs-built_in">print</span>(my_private_key)<br><span class="hljs-built_in">print</span>(ciphretext.<span class="hljs-built_in">hex</span>())<br><span class="hljs-built_in">print</span>(iv.<span class="hljs-built_in">hex</span>())<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">14489</span><br><span class="hljs-string">10289</span><br><span class="hljs-string">7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span><br><span class="hljs-string">(1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207 : 1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459 : 1)</span><br><span class="hljs-string">2549545681219766023689977461986014915946503806253877534915175093306317852773</span><br><span class="hljs-string">2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23</span><br><span class="hljs-string">d151c04c645c3e2a8d3f1ae44589ef20</span><br><span class="hljs-string">“”“</span><br></code></pre></td></tr></table></figure>
<p>考的是ECDH，这个形式上和DH密钥交换协议没啥区别。所以很好写。</p>
<p>对于一方A来说：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>=</mo><msub><mi>d</mi><mi>A</mi></msub><mo>∗</mo><msub><mi>H</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">S = d_A*H_B
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>d</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">d_A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是A的私钥，而<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">H_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是另一方的公钥。题目中给出了一个另一方的公钥，所以直接计算共享密钥即可。只不过他这个代码一开始没看到这几个变量到底是谁跟谁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">from</span> binascii <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><br>a = <span class="hljs-number">14489</span><br>b = <span class="hljs-number">10289</span><br>p = <span class="hljs-number">7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span><br><br>F = GF(p)<br>E = EllipticCurve(F, [a, b])<br><br>sender_public_key = E(<span class="hljs-number">1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207</span> , <span class="hljs-number">1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459</span>)<br>my_private_key = <span class="hljs-number">2549545681219766023689977461986014915946503806253877534915175093306317852773</span><br><br>shared =  my_private_key*sender_public_key<br>key = md5(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared.xy()[<span class="hljs-number">0</span>])).encode()).digest()<br><br>cipher = <span class="hljs-string">&quot;2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23&quot;</span><br>iv = <span class="hljs-string">&quot;d151c04c645c3e2a8d3f1ae44589ef20&quot;</span><br><br>decoder = AES.new(key, AES.MODE_CBC, unhexlify(iv))<br><span class="hljs-built_in">print</span>(decoder.decrypt(unhexlify(cipher)))<br><br><span class="hljs-comment"># b&#x27;flag&#123;ell1ptic_curv3_i5_be4ut1ful_right#4DF17ABE&#125;&#x27;</span><br><br><span class="hljs-comment"># flag&#123;ell1ptic_curv3_i5_be4ut1ful_right#4DF17ABE&#125;</span><br></code></pre></td></tr></table></figure>
<p>密码学，AK！</p>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> Reverse</h2>
<h3 id="前可见古人后得见来者"><a class="markdownIt-Anchor" href="#前可见古人后得见来者"></a> 前可见古人，后得见来者</h3>
<p>IDA反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [esp+0h] [ebp-114h]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-114h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+D0h] [ebp-44h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+DCh] [ebp-38h]</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">40</span>]; <span class="hljs-comment">// [esp+E8h] [ebp-2Ch] BYREF</span><br><br>  __CheckForDebuggerJustMyCode(&amp;unk_41C015);<br>  j__atexit(sub_41117C);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please Input Flag: \n&quot;</span>, v4);<br>  <span class="hljs-built_in">cin</span>(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">char</span>)Str);<br>  v7 = j_strlen(Str);<br>  sub_4113DE(Str, v7);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( i &gt;= v7 )<br>    &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations!!!\n&quot;</span>, v5);<br>      system(<span class="hljs-string">&quot;pause&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( Str[i] != (<span class="hljs-type">unsigned</span> __int8)byte_41A004[i] )<br>      <span class="hljs-keyword">break</span>;<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;No...Try again!!!\n&quot;</span>, v5);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>关键函数为sub_4113DE</p>
<p>要求在经过sub_4113DE函数之后，数据要与byte_41A004相等。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_4118C0</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// [esp+D0h] [ebp-14h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+DCh] [ebp-8h]</span><br><br>  __CheckForDebuggerJustMyCode(&amp;unk_41C015);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; a2; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( *(<span class="hljs-type">char</span> *)(i + a1) &lt; <span class="hljs-number">65</span> || *(<span class="hljs-type">char</span> *)(i + a1) &gt; <span class="hljs-number">90</span> )<span class="hljs-comment">// 不是大写字母</span><br>    &#123;<br>      <span class="hljs-keyword">if</span> ( *(<span class="hljs-type">char</span> *)(i + a1) &gt;= <span class="hljs-number">97</span> &amp;&amp; *(<span class="hljs-type">char</span> *)(i + a1) &lt;= <span class="hljs-number">122</span> )<span class="hljs-comment">// 小写字母</span><br>        *(_BYTE *)(i + a1) = (*(<span class="hljs-type">char</span> *)(i + a1) + dword_41A000 - <span class="hljs-number">97</span>) % <span class="hljs-number">0x1A</span>u + <span class="hljs-number">97</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      *(_BYTE *)(i + a1) = (*(<span class="hljs-type">char</span> *)(i + a1) + dword_41A000 - <span class="hljs-number">65</span>) % <span class="hljs-number">0x1A</span>u + <span class="hljs-number">65</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; ; ++j )<br>  &#123;<br>    result = j;<br>    <span class="hljs-keyword">if</span> ( j &gt;= a2 )<br>      <span class="hljs-keyword">break</span>;<br>    *(_BYTE *)(j + a1) ^= <span class="hljs-number">0x22</span>u;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里是对数据进行处理，看样子是位移。最后有个循环进行异或加密。先得到异或之前的数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.strxor <span class="hljs-keyword">import</span> strxor<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> ascii_lowercase,ascii_uppercase<br><br>STR = <span class="hljs-string">b&quot;Q[LVYMPVTC&#125;LCS&#125;PCS&#125;GP&#125;LCS&#125;N@J_&quot;</span><br>Key = <span class="hljs-string">b&quot;\x22&quot;</span>*<span class="hljs-built_in">len</span>(STR)<br><br>reverse_STR = strxor(STR,Key).decode(<span class="hljs-string">&quot;UTF-8&quot;</span>)<br><br><span class="hljs-built_in">print</span>(reverse_STR)<br><br><span class="hljs-comment"># synt&#123;ortva_naq_raq_er_naq_lbh&#125;</span><br></code></pre></td></tr></table></figure>
<p>一眼ROT13，解得：</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;begin_and_end_re_and_you&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="findme"><a class="markdownIt-Anchor" href="#findme"></a> FindME</h3>
<p>IDA反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;##    ##  #######  ##     ## ########      ######   #### ######## ########&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot; ##  ##  ##     ## ##     ## ##     ##    ##    ##   ##  ##          ##   &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;  ####   ##     ## ##     ## ##     ##    ##         ##  ##          ##   &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;   ##    ##     ## ##     ## ########     ##   ####  ##  ######      ##   &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;   ##    ##     ## ##     ## ##   ##      ##    ##   ##  ##          ##   &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;   ##    ##     ## ##     ## ##    ##     ##    ##   ##  ##          ##   &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;   ##     #######   #######  ##     ##     ######   #### ##          ##   &quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Gift key:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, byte_50A0);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(byte_50A0) != <span class="hljs-number">32</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Wrong Length!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Sorry Sir, I need some time.&quot;</span>);<br>  sub_1BCD();<br>  <span class="hljs-keyword">if</span> ( dword_5040 )<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;You Gift:%s\n&quot;</span>, byte_50A0);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Wait.....&quot;</span>);<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Warning,hacker robbed your gift!!!&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>关键的判断是dword_5040这个值，查一下引用。在sub_1253处有引用修改。</p>
<p>sub_1BCD函数里面嵌套了很多函数，有意义的函数是sub_1B10，sub_19B6，sub_192E</p>
<p>，sub_151D，sub_1253。</p>
<p>观察可以发现这几个函数其实可以连在一起。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c">s = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x20</span>uLL);<br><span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x20</span>uLL);<br><br><span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+8h] [rbp-8h]</span><br><span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">31</span>; i += <span class="hljs-number">4</span> )<br>&#123;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt;= <span class="hljs-number">3</span>; ++j )<br>    *((_DWORD *)s + i / <span class="hljs-number">4</span>) |= byte_50A0[i + j] &lt;&lt; (<span class="hljs-number">8</span> * j);<br>&#125;<br><span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>  *((_DWORD *)s + i) ^= <span class="hljs-number">0x2022</span>u;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>  *((_DWORD *)s + i) ^= *((_DWORD *)s + i) &gt;&gt; <span class="hljs-number">17</span>;<br>  <br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>&#123;<br>  <span class="hljs-keyword">if</span> ( *((_DWORD *)s + i) != dword_5020[i] )<br>  &#123;<br>    dword_5040 = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> sub_123E();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>第一个for循环其实就是赋值操作。这里全部是DWORD类型，所以每次操作都是4字节的。</p>
<p>每四个字节先进行异或0x2022，然后位移异或得到最终结果。所以我们来爆破求解即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><br>data = [<span class="hljs-number">0x67617FF4</span>, <span class="hljs-number">0x6E305341</span>, <span class="hljs-number">0x656C4DE0</span>, <span class="hljs-number">0x69744BEC</span>, <span class="hljs-number">0x625F7460</span>, <span class="hljs-number">0x6F7348F4</span>, <span class="hljs-number">0x656871C9</span>, <span class="hljs-number">0x7D216ED3</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>    target = data[i]<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> itertools.product(*(ascii_uppercase + ascii_lowercase + digits + <span class="hljs-string">&quot;_&#123;&#125;!&quot;</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>))):<br>        temp = bytes_to_long(<span class="hljs-string">&quot;&quot;</span>.join(j).encode(<span class="hljs-string">&quot;UTF-8&quot;</span>))<br>        temp ^= <span class="hljs-number">0x2022</span><br>        temp ^= temp &gt;&gt; <span class="hljs-number">17</span><br>        <span class="hljs-keyword">if</span> temp == target:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join(j)[::-<span class="hljs-number">1</span>], end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-comment"># print(&quot;\n&quot;)</span><br><br><br><span class="hljs-comment"># flag&#123;D0nt_let_time_bo_so_cheap!&#125;</span><br></code></pre></td></tr></table></figure>
<p>里面这个bo可把我吓坏了，然而结果确实是这个。</p>
<h3 id="petals"><a class="markdownIt-Anchor" href="#petals"></a> Petals</h3>
<p>IDA反汇编，这里有些变量我自己修饰了一些。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">char</span> **a2, <span class="hljs-type">char</span> **a3)</span><br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> lens; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Here is a pack of flowers, to my best love --- you.&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;But I must check your identity, please input the right passwd&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, input_data);<br>  lens = <span class="hljs-built_in">strlen</span>(input_data);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(input_data) != <span class="hljs-number">25</span> )<br>  &#123;<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Please check your input&#x27;s format!&quot;</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">-1</span>);<br>  &#125;<br>  ((<span class="hljs-type">void</span> (__fastcall *)(<span class="hljs-type">char</span> *, _QWORD))((<span class="hljs-type">char</span> *)&amp;sub_1208 + <span class="hljs-number">1</span>))(input_data, lens);<br>  sub_160C(input_data, &amp;target, lens);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;If you are succeed, the flag is flag&#123;md5(your input)&#125;&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>sub_160C起始就是一个比较函数。关键点在于</p>
<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">((<span class="hljs-name">void</span> (<span class="hljs-name">__fastcall</span> *)(<span class="hljs-name">char</span> *<span class="hljs-punctuation">,</span> _QWORD))((<span class="hljs-name">char</span> *)&amp;sub_1208 + <span class="hljs-number">1</span>))(<span class="hljs-name">input_data</span><span class="hljs-punctuation">,</span> lens)<br></code></pre></td></tr></table></figure>
<p>这里反汇编出的结果不正确，我们函数错位了。手动修正。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001208</span>                 <span class="hljs-built_in">db</span> <span class="hljs-number">0FFh</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001209</span> <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001209</span> <span class="hljs-comment">; __unwind &#123;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001209</span>                 endbr64                 <span class="hljs-comment">; CODE XREF: main+9E↓p</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000000120D</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000000000120E                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbp</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001211</span>                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">130h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001218</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">128h</span>], <span class="hljs-built_in">rdi</span><br><span class="hljs-symbol">.text:</span>000000000000121F                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">12Ch</span>], <span class="hljs-built_in">esi</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001225</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rax</span>, <span class="hljs-built_in">fs</span>:<span class="hljs-number">28h</span><br><span class="hljs-symbol">.text:</span>000000000000122E                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>-<span class="hljs-number">8</span>], <span class="hljs-built_in">rax</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000001232</span>                 <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br>...<br></code></pre></td></tr></table></figure>
<p>从1209位置重新生成函数。下面：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">.text:<span class="hljs-number">00000000000013AE</span>                 jnz     short near ptr loc_13B0+<span class="hljs-number">1</span><br>.text:<span class="hljs-number">00000000000013B0</span><br>.text:<span class="hljs-number">00000000000013B0</span> loc_13B0:                               ; CODE XREF: .text:<span class="hljs-number">00000000000013AC</span>↑j<br>.text:<span class="hljs-number">00000000000013B0</span>                                         ; .text:<span class="hljs-number">00000000000013AE</span>↑j<br>.text:<span class="hljs-number">00000000000013B0</span>                 call    near ptr <span class="hljs-number">0FFFFFFFFFEEC997Ch</span><br></code></pre></td></tr></table></figure>
<p>这个地方出现了loc_13B0+1，而且call的值也不正确，这里也是地址出问题。我们也需要手动修改。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs maxima">.text:<span class="hljs-number">00000000000013A0</span>                 cmp     dword ptr [rbp-118h], <span class="hljs-number">0FFh</span><br>.text:<span class="hljs-number">00000000000013AA</span>                 jle     short loc_1376<br>.text:<span class="hljs-number">00000000000013AC</span>                 jz      short loc_13B1<br>.text:<span class="hljs-number">00000000000013AE</span>                 jnz     short loc_13B1<br>.text:<span class="hljs-number">00000000000013AE</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000000013B0</span>                 db <span class="hljs-number">0E8h</span><br>.text:<span class="hljs-number">00000000000013B1</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000000013B1</span><br>.text:<span class="hljs-number">00000000000013B1</span> loc_13B1:                               ; CODE XREF: .text:<span class="hljs-number">00000000000013AC</span>↑j<br>.text:<span class="hljs-number">00000000000013B1</span>                                         ; .text:<span class="hljs-number">00000000000013AE</span>↑j<br>.text:<span class="hljs-number">00000000000013B1</span>                 mov     dword ptr [rbp-114h], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">00000000000013BB</span>                 jmp     short loc_13FC<br></code></pre></td></tr></table></figure>
<p>但是这里出现了一个问题，13B0处并不是指令。这会让我们无法创建函数。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">.text:<span class="hljs-number">00000000000013B0</span>: The function has undefined instruction/data <span class="hljs-built_in">at</span> the specified address.<br>Your request has been <span class="hljs-built_in">put</span> <span class="hljs-keyword">in</span> the autoanalysis queue.<br></code></pre></td></tr></table></figure>
<p>创建的时候果然失败了。这里手动修改，13b0上面是两条跳转jz和jnz其实就相当于jmp，我们改13b0不会有任何问题。这个直接用二进制查看器重新这个字节修改成0x90。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs maxima">.text:<span class="hljs-number">00000000000013A0</span><br>.text:<span class="hljs-number">00000000000013A0</span> loc_13A0:                               ; CODE XREF: .text:<span class="hljs-number">0000000000001374</span>↑j<br>.text:<span class="hljs-number">00000000000013A0</span>                 cmp     dword ptr [rbp-118h], <span class="hljs-number">0FFh</span><br>.text:<span class="hljs-number">00000000000013AA</span>                 jle     short loc_1376<br>.text:<span class="hljs-number">00000000000013AC</span>                 jz      short loc_13B1<br>.text:<span class="hljs-number">00000000000013AE</span>                 jnz     short loc_13B1<br>.text:<span class="hljs-number">00000000000013B0</span>                 nop<br>.text:<span class="hljs-number">00000000000013B1</span><br>.text:<span class="hljs-number">00000000000013B1</span> loc_13B1:                               ; CODE XREF: .text:<span class="hljs-number">00000000000013AC</span>↑j<br>.text:<span class="hljs-number">00000000000013B1</span>                                         ; .text:<span class="hljs-number">00000000000013AE</span>↑j<br>.text:<span class="hljs-number">00000000000013B1</span>                 mov     dword ptr [rbp-114h], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">00000000000013BB</span>                 jmp     short loc_13FC<br></code></pre></td></tr></table></figure>
<p>然后再重新生成函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> __int64 __fastcall <span class="hljs-title function_">sub_1209</span><span class="hljs-params">(__int64 input_data, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> lens)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+18h] [rbp-118h]</span><br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> j; <span class="hljs-comment">// [rsp+1Ch] [rbp-114h]</span><br>  __int64 v5[<span class="hljs-number">33</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-110h]</span><br>  <span class="hljs-type">unsigned</span> __int64 v6; <span class="hljs-comment">// [rsp+128h] [rbp-8h]</span><br><br>  v6 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  v5[<span class="hljs-number">0</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">1</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">2</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">3</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">4</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">5</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">6</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">7</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">8</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">9</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">10</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">11</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">12</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">13</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">14</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">15</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">16</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">17</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">18</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">19</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">20</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">21</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">22</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">23</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">24</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">25</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">26</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">27</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">28</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">29</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">30</span>] = <span class="hljs-number">0LL</span>;<br>  v5[<span class="hljs-number">31</span>] = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">255</span>; ++i )<br>    *((_BYTE *)v5 + i) = ~(i ^ lens);<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; lens &gt; j; ++j )<br>    *(_BYTE *)(j + input_data) = *((_BYTE *)v5 + *(<span class="hljs-type">unsigned</span> __int8 *)(j + input_data));<br>  <span class="hljs-keyword">return</span> v6 - __readfsqword(<span class="hljs-number">0x28</span>u);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这样我们就得到了这个函数的正确结果。</p>
<p>这里第一个for循环先是生成了一个表。然后第二for循环根据输入的值，来从表里面找对应的数据覆盖原来的位置。所以我们字节生成一个表进行反查即可。反查的数据所在的index就是原本的值。然后转字符，生成md5即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br>buffer = []<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    buffer.append(~(i^<span class="hljs-number">25</span>) &amp; <span class="hljs-number">255</span>)<br><br>target = <span class="hljs-string">&quot;D0 D0 85 85 80 80 C5 8A  93 89 92 8F 87 88 9F 8F C5 84 D6 D1 D2 82 D3 DE 87&quot;</span>.replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&quot;</span>)<br>target = long_to_bytes(<span class="hljs-built_in">int</span>(target,<span class="hljs-number">16</span>))<br><br>Res = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> target:<br>    Res += <span class="hljs-built_in">chr</span>(buffer.index(i))<br><br><span class="hljs-built_in">print</span>(Res)<br><span class="hljs-built_in">print</span>(md5(Res.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)).hexdigest())<br><br><span class="hljs-comment"># 66ccff#luotianyi#b074d58a</span><br><span class="hljs-comment"># d780c9b2d2aa9d40010a753bc15770de</span><br><br><span class="hljs-comment"># flag&#123;d780c9b2d2aa9d40010a753bc15770de&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="zzzzzz3333"><a class="markdownIt-Anchor" href="#zzzzzz3333"></a> Zzzzzz3333</h3>
<p>这题名字已经给提示了，我看到这个z3就怀疑是不是里面给了很多等式要来解。没想到果然。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v3; <span class="hljs-comment">// di</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> v6; <span class="hljs-comment">// [esp-10h] [ebp-30h]</span><br>  <span class="hljs-type">char</span> Arglist[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [esp+0h] [ebp-20h] BYREF</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+8h] [ebp-18h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+Ch] [ebp-14h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+10h] [ebp-10h]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+14h] [ebp-Ch]</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp+18h] [ebp-8h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp+1Ch] [ebp-4h]</span><br><br>  *(_DWORD *)&amp;Arglist[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>  sub_401020(<span class="hljs-string">&quot;Please Give the Key:&quot;</span>, <span class="hljs-number">0</span>);<br>  sub_401050(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">char</span>)Arglist);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Arglist) != <span class="hljs-number">8</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  v13 = Arglist[<span class="hljs-number">5</span>];<br>  v11 = Arglist[<span class="hljs-number">4</span>];<br>  v9 = Arglist[<span class="hljs-number">1</span>];<br>  v12 = Arglist[<span class="hljs-number">3</span>];<br>  v8 = Arglist[<span class="hljs-number">7</span>];<br>  v10 = Arglist[<span class="hljs-number">0</span>];<br>  <span class="hljs-keyword">if</span> ( Arglist[<span class="hljs-number">3</span>]<br>     + <span class="hljs-number">4</span> * Arglist[<span class="hljs-number">2</span>]<br>     + Arglist[<span class="hljs-number">7</span>]<br>     + <span class="hljs-number">4</span> * (Arglist[<span class="hljs-number">3</span>] + <span class="hljs-number">4</span> * Arglist[<span class="hljs-number">2</span>])<br>     + <span class="hljs-number">3</span> * (Arglist[<span class="hljs-number">4</span>] + <span class="hljs-number">4</span> * Arglist[<span class="hljs-number">0</span>])<br>     + <span class="hljs-number">2</span> * (Arglist[<span class="hljs-number">5</span>] + <span class="hljs-number">4</span> * Arglist[<span class="hljs-number">6</span>])<br>     + <span class="hljs-number">11</span> * Arglist[<span class="hljs-number">1</span>] == <span class="hljs-number">6426</span><br>    &amp;&amp; <span class="hljs-number">11</span> * (v10 + v8 + v12) + <span class="hljs-number">4</span> * (v13 + <span class="hljs-number">2</span> * v11) + Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">45</span> * v9 + <span class="hljs-number">7</span> * Arglist[<span class="hljs-number">6</span>] == <span class="hljs-number">9801</span><br>    &amp;&amp; <span class="hljs-number">5</span> * v9<br>     + <span class="hljs-number">2</span> * (v11 + Arglist[<span class="hljs-number">6</span>] + v13 + <span class="hljs-number">2</span> * (v8 + v12) + Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">2</span> * (Arglist[<span class="hljs-number">6</span>] + v13 + <span class="hljs-number">2</span> * (v8 + v12)) + <span class="hljs-number">8</span> * v10) == <span class="hljs-number">6021</span><br>    &amp;&amp; <span class="hljs-number">19</span> * v10 + <span class="hljs-number">9</span> * v9 + <span class="hljs-number">67</span> * v8 + <span class="hljs-number">5</span> * (Arglist[<span class="hljs-number">2</span>] + Arglist[<span class="hljs-number">6</span>]) + <span class="hljs-number">7</span> * (v13 + <span class="hljs-number">4</span> * v12) + <span class="hljs-number">4</span> * v11 == <span class="hljs-number">14444</span><br>    &amp;&amp; <span class="hljs-number">22</span> * v13 + <span class="hljs-number">5</span> * (v11 + <span class="hljs-number">2</span> * (v12 + v9 + <span class="hljs-number">2</span> * v10)) + <span class="hljs-number">4</span> * (v8 + Arglist[<span class="hljs-number">6</span>]) + <span class="hljs-number">6</span> * Arglist[<span class="hljs-number">2</span>] == <span class="hljs-number">7251</span><br>    &amp;&amp; <span class="hljs-number">19</span> * v12<br>     + <span class="hljs-number">3</span> * (v8 + Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">4</span> * v8 + Arglist[<span class="hljs-number">6</span>] + <span class="hljs-number">2</span> * (v8 + Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">4</span> * v8))<br>     + <span class="hljs-number">4</span> * (v10 + v13 + v9 + <span class="hljs-number">2</span> * (v10 + v13)) == <span class="hljs-number">10054</span><br>    &amp;&amp; (v9 *= <span class="hljs-number">2</span>,<br>        <span class="hljs-number">7</span> * v10 + <span class="hljs-number">17</span> * (v12 + v9) + <span class="hljs-number">11</span> * (v11 + <span class="hljs-number">2</span> * v13) + <span class="hljs-number">2</span> * (Arglist[<span class="hljs-number">2</span>] + Arglist[<span class="hljs-number">6</span>] + <span class="hljs-number">4</span> * Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">6</span> * v8) == <span class="hljs-number">10735</span>)<br>    &amp;&amp; Arglist[<span class="hljs-number">6</span>] + v11 + <span class="hljs-number">11</span> * Arglist[<span class="hljs-number">2</span>] + <span class="hljs-number">15</span> * (v12 + <span class="hljs-number">2</span> * v8) + v9 + <span class="hljs-number">43</span> * v10 + <span class="hljs-number">21</span> * v13 == <span class="hljs-number">11646</span> )<br>  &#123;<br>    sub_401020(<span class="hljs-string">&quot;The Key is Right!!\n&quot;</span>, v3);<br>    sub_401020(<span class="hljs-string">&quot;Your flag is here:)\n&quot;</span>, v6);<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; ++i )<br>      sub_401020(<br>        <span class="hljs-string">&quot;%c&quot;</span>,<br>        byte_402168[i] &amp; (Arglist[i &amp; <span class="hljs-number">7</span>] ^ byte_402168[i]) | ~byte_402168[i] &amp; (~byte_402168[i] ^ ~Arglist[i &amp; <span class="hljs-number">7</span>]));<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    sub_401020(<span class="hljs-string">&quot;Your Key is Wrong\n&quot;</span>, v3);<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里把等式提出来，然后手动修一下表示。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( d + <span class="hljs-number">4</span> * c + h + <span class="hljs-number">4</span> * (d + <span class="hljs-number">4</span> * c) + <span class="hljs-number">3</span> * (e + <span class="hljs-number">4</span> * a) + <span class="hljs-number">2</span> * (f + <span class="hljs-number">4</span> * g)+ <span class="hljs-number">11</span> * b == <span class="hljs-number">6426</span><br>  &amp;&amp; <span class="hljs-number">11</span> * (a + h + d) + <span class="hljs-number">4</span> * (f + <span class="hljs-number">2</span> * e) + c + <span class="hljs-number">45</span> * b + <span class="hljs-number">7</span> * g == <span class="hljs-number">9801</span><br>  &amp;&amp; <span class="hljs-number">5</span> * b + <span class="hljs-number">2</span> * (e + g + f + <span class="hljs-number">2</span> * (h + d) + c + <span class="hljs-number">2</span> * (g + f + <span class="hljs-number">2</span> * (h + d)) + <span class="hljs-number">8</span> * a) == <span class="hljs-number">6021</span><br>  &amp;&amp; <span class="hljs-number">19</span> * a + <span class="hljs-number">9</span> * b + <span class="hljs-number">67</span> * h + <span class="hljs-number">5</span> * (c + g) + <span class="hljs-number">7</span> * (f + <span class="hljs-number">4</span> * d) + <span class="hljs-number">4</span> * e == <span class="hljs-number">14444</span><br>  &amp;&amp; <span class="hljs-number">22</span> * f + <span class="hljs-number">5</span> * (e + <span class="hljs-number">2</span> * (d + b + <span class="hljs-number">2</span> * a)) + <span class="hljs-number">4</span> * (h + g) + <span class="hljs-number">6</span> * c == <span class="hljs-number">7251</span><br>  &amp;&amp; <span class="hljs-number">19</span> * d + <span class="hljs-number">3</span> * (h + c + <span class="hljs-number">4</span> * h + g + <span class="hljs-number">2</span> * (h + c + <span class="hljs-number">4</span> * h)) + <span class="hljs-number">4</span> * (a + f + b + <span class="hljs-number">2</span> * (a + f)) == <span class="hljs-number">10054</span><br>  &amp;&amp; (b *= <span class="hljs-number">2</span>, <span class="hljs-number">7</span> * a + <span class="hljs-number">17</span> * (d + b) + <span class="hljs-number">11</span> * (e + <span class="hljs-number">2</span> * f) + <span class="hljs-number">2</span> * (c + g + <span class="hljs-number">4</span> * c + <span class="hljs-number">6</span> * h) == <span class="hljs-number">10735</span>)<br>  &amp;&amp; g + e + <span class="hljs-number">11</span> * c + <span class="hljs-number">15</span> * (d + <span class="hljs-number">2</span> * h) + b + <span class="hljs-number">43</span> * a + <span class="hljs-number">21</span> * f == <span class="hljs-number">11646</span> )<br></code></pre></td></tr></table></figure>
<p>对了，这里倒数第二个式子里面包了一个b = b*2…</p>
<p>最后是这样子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> ( d + <span class="hljs-number">4</span> * c + h + <span class="hljs-number">4</span> * (d + <span class="hljs-number">4</span> * c) + <span class="hljs-number">3</span> * (e + <span class="hljs-number">4</span> * a) + <span class="hljs-number">2</span> * (f + <span class="hljs-number">4</span> * g)+ <span class="hljs-number">11</span> * b == <span class="hljs-number">6426</span><br>  &amp;&amp; <span class="hljs-number">11</span> * (a + h + d) + <span class="hljs-number">4</span> * (f + <span class="hljs-number">2</span> * e) + c + <span class="hljs-number">45</span> * b + <span class="hljs-number">7</span> * g == <span class="hljs-number">9801</span><br>  &amp;&amp; <span class="hljs-number">5</span> * b + <span class="hljs-number">2</span> * (e + g + f + <span class="hljs-number">2</span> * (h + d) + c + <span class="hljs-number">2</span> * (g + f + <span class="hljs-number">2</span> * (h + d)) + <span class="hljs-number">8</span> * a) == <span class="hljs-number">6021</span><br>  &amp;&amp; <span class="hljs-number">19</span> * a + <span class="hljs-number">9</span> * b + <span class="hljs-number">67</span> * h + <span class="hljs-number">5</span> * (c + g) + <span class="hljs-number">7</span> * (f + <span class="hljs-number">4</span> * d) + <span class="hljs-number">4</span> * e == <span class="hljs-number">14444</span><br>  &amp;&amp; <span class="hljs-number">22</span> * f + <span class="hljs-number">5</span> * (e + <span class="hljs-number">2</span> * (d + b + <span class="hljs-number">2</span> * a)) + <span class="hljs-number">4</span> * (h + g) + <span class="hljs-number">6</span> * c == <span class="hljs-number">7251</span><br>  &amp;&amp; <span class="hljs-number">19</span> * d + <span class="hljs-number">3</span> * (h + c + <span class="hljs-number">4</span> * h + g + <span class="hljs-number">2</span> * (h + c + <span class="hljs-number">4</span> * h)) + <span class="hljs-number">4</span> * (a + f + b + <span class="hljs-number">2</span> * (a + f)) == <span class="hljs-number">10054</span><br>  &amp;&amp; <span class="hljs-number">7</span> * a + <span class="hljs-number">17</span> * (d + b*<span class="hljs-number">2</span>) + <span class="hljs-number">11</span> * (e + <span class="hljs-number">2</span> * f) + <span class="hljs-number">2</span> * (c + g + <span class="hljs-number">4</span> * c + <span class="hljs-number">6</span> * h) == <span class="hljs-number">10735</span><br>  &amp;&amp; g + e + <span class="hljs-number">11</span> * c + <span class="hljs-number">15</span> * (d + <span class="hljs-number">2</span> * h) + b*<span class="hljs-number">2</span> + <span class="hljs-number">43</span> * a + <span class="hljs-number">21</span> * f == <span class="hljs-number">11646</span> )<br></code></pre></td></tr></table></figure>
<p>然后用z3约束求解即可。(用sagemath也行)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>a,b,c,d,e,f,g, h = Ints(<span class="hljs-string">&quot;a b c d e f g h&quot;</span>)<br>sl = Solver()<br>sl.add(<br>    d + <span class="hljs-number">4</span> * c + h + <span class="hljs-number">4</span> * (d + <span class="hljs-number">4</span> * c) + <span class="hljs-number">3</span> * (e + <span class="hljs-number">4</span> * a) + <span class="hljs-number">2</span> * (f + <span class="hljs-number">4</span> * g) + <span class="hljs-number">11</span> * b == <span class="hljs-number">6426</span>,<br>    <span class="hljs-number">11</span> * (a + h + d) + <span class="hljs-number">4</span> * (f + <span class="hljs-number">2</span> * e) + c + <span class="hljs-number">45</span> * b + <span class="hljs-number">7</span> * g == <span class="hljs-number">9801</span>,<br>    <span class="hljs-number">5</span> * b + <span class="hljs-number">2</span> * (e + g + f + <span class="hljs-number">2</span> * (h + d) + c + <span class="hljs-number">2</span> * (g + f + <span class="hljs-number">2</span> * (h + d)) + <span class="hljs-number">8</span> * a) == <span class="hljs-number">6021</span>,<br>    <span class="hljs-number">19</span> * a + <span class="hljs-number">9</span> * b + <span class="hljs-number">67</span> * h + <span class="hljs-number">5</span> * (c + g) + <span class="hljs-number">7</span> * (f + <span class="hljs-number">4</span> * d) + <span class="hljs-number">4</span> * e == <span class="hljs-number">14444</span>,<br>    <span class="hljs-number">22</span> * f + <span class="hljs-number">5</span> * (e + <span class="hljs-number">2</span> * (d + b + <span class="hljs-number">2</span> * a)) + <span class="hljs-number">4</span> * (h + g) + <span class="hljs-number">6</span> * c == <span class="hljs-number">7251</span>,<br>    <span class="hljs-number">19</span> * d + <span class="hljs-number">3</span> * (h + c + <span class="hljs-number">4</span> * h + g + <span class="hljs-number">2</span> * (h + c + <span class="hljs-number">4</span> * h)) + <span class="hljs-number">4</span> * (a + f + b + <span class="hljs-number">2</span> * (a + f)) == <span class="hljs-number">10054</span>,<br>    <span class="hljs-number">7</span> * a + <span class="hljs-number">17</span> * (d + b * <span class="hljs-number">2</span>) + <span class="hljs-number">11</span> * (e + <span class="hljs-number">2</span> * f) + <span class="hljs-number">2</span> * (c + g + <span class="hljs-number">4</span> * c + <span class="hljs-number">6</span> * h) == <span class="hljs-number">10735</span>,<br>    g + e + <span class="hljs-number">11</span> * c + <span class="hljs-number">15</span> * (d + <span class="hljs-number">2</span> * h) + b * <span class="hljs-number">2</span> + <span class="hljs-number">43</span> * a + <span class="hljs-number">21</span> * f == <span class="hljs-number">11646</span><br>)<br><span class="hljs-keyword">if</span> sl.check() == sat:<br>    ans = sl.model()<br><br>byte_402168 = binascii.unhexlify(<span class="hljs-string">&quot;000D0D0B0C6B141E1C525F5F28781D3B250E030056104F19&quot;</span>)<br>Arglist = <span class="hljs-built_in">bytes</span>([ans[a].as_long(),ans[b].as_long(),ans[c].as_long(),ans[d].as_long(),ans[e].as_long(),ans[f].as_long(),ans[g].as_long(),ans[h].as_long()])<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(byte_402168[i] &amp; (Arglist[i &amp; <span class="hljs-number">7</span>] ^ byte_402168[i]) | ~byte_402168[i] &amp; (~byte_402168[i] ^ ~Arglist[i &amp; <span class="hljs-number">7</span>])), end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-comment"># flag&#123;Zzzz333_Is_Cool!!!&#125;</span><br></code></pre></td></tr></table></figure>
<p>z3这个输出数据使用简直折磨。</p>
<p>还是sagemath好用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> binascii<br><br>var(<span class="hljs-string">&quot;a,b,c,d,e,f,g,h&quot;</span>)<br>res = solve(<span class="hljs-number">4</span><br>    [<br>    d + <span class="hljs-number">4</span> * c + h + <span class="hljs-number">4</span> * (d + <span class="hljs-number">4</span> * c) + <span class="hljs-number">3</span> * (e + <span class="hljs-number">4</span> * a) + <span class="hljs-number">2</span> * (f + <span class="hljs-number">4</span> * g) + <span class="hljs-number">11</span> * b == <span class="hljs-number">6426</span>,<br>    <span class="hljs-number">11</span> * (a + h + d) + <span class="hljs-number">4</span> * (f + <span class="hljs-number">2</span> * e) + c + <span class="hljs-number">45</span> * b + <span class="hljs-number">7</span> * g == <span class="hljs-number">9801</span>,<br>    <span class="hljs-number">5</span> * b + <span class="hljs-number">2</span> * (e + g + f + <span class="hljs-number">2</span> * (h + d) + c + <span class="hljs-number">2</span> * (g + f + <span class="hljs-number">2</span> * (h + d)) + <span class="hljs-number">8</span> * a) == <span class="hljs-number">6021</span>,<br>    <span class="hljs-number">19</span> * a + <span class="hljs-number">9</span> * b + <span class="hljs-number">67</span> * h + <span class="hljs-number">5</span> * (c + g) + <span class="hljs-number">7</span> * (f + <span class="hljs-number">4</span> * d) + <span class="hljs-number">4</span> * e == <span class="hljs-number">14444</span>,<br>    <span class="hljs-number">22</span> * f + <span class="hljs-number">5</span> * (e + <span class="hljs-number">2</span> * (d + b + <span class="hljs-number">2</span> * a)) + <span class="hljs-number">4</span> * (h + g) + <span class="hljs-number">6</span> * c == <span class="hljs-number">7251</span>,<br>    <span class="hljs-number">19</span> * d + <span class="hljs-number">3</span> * (h + c + <span class="hljs-number">4</span> * h + g + <span class="hljs-number">2</span> * (h + c + <span class="hljs-number">4</span> * h)) + <span class="hljs-number">4</span> * (a + f + b + <span class="hljs-number">2</span> * (a + f)) == <span class="hljs-number">10054</span>,<br>    <span class="hljs-number">7</span> * a + <span class="hljs-number">17</span> * (d + b * <span class="hljs-number">2</span>) + <span class="hljs-number">11</span> * (e + <span class="hljs-number">2</span> * f) + <span class="hljs-number">2</span> * (c + g + <span class="hljs-number">4</span> * c + <span class="hljs-number">6</span> * h) == <span class="hljs-number">10735</span>,<br>    g + e + <span class="hljs-number">11</span> * c + <span class="hljs-number">15</span> * (d + <span class="hljs-number">2</span> * h) + b * <span class="hljs-number">2</span> + <span class="hljs-number">43</span> * a + <span class="hljs-number">21</span> * f == <span class="hljs-number">11646</span><br>    ],<br>    a,b,c,d,e,f,g,h<br>)[<span class="hljs-number">0</span>]<br><br>key = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res:<br>    key.append(<span class="hljs-built_in">int</span>(i.operands()[<span class="hljs-number">1</span>]))<br>    <br>byte_402168 = binascii.unhexlify(<span class="hljs-string">&quot;000D0D0B0C6B141E1C525F5F28781D3B250E030056104F19&quot;</span>)<br>Arglist = <span class="hljs-built_in">bytes</span>(key)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(byte_402168[i] &amp; (Arglist[i &amp; <span class="hljs-number">7</span>] ^^ byte_402168[i]) | ~byte_402168[i] &amp; (~byte_402168[i] ^^ ~Arglist[i &amp; <span class="hljs-number">7</span>])), end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-comment"># flag&#123;Zzzz333_Is_Cool!!!&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="hash"><a class="markdownIt-Anchor" href="#hash"></a> Hash</h3>
<p>IDA反汇编</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [esp+0h] [ebp-258h]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-258h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+D0h] [ebp-188h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+DCh] [ebp-17Ch]</span><br>  <span class="hljs-type">size_t</span> v8; <span class="hljs-comment">// [esp+E8h] [ebp-170h]</span><br>  DWORD v9[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+F4h] [ebp-164h] BYREF</span><br>  BYTE v10[<span class="hljs-number">264</span>]; <span class="hljs-comment">// [esp+100h] [ebp-158h] BYREF</span><br>  <span class="hljs-type">char</span> Destination; <span class="hljs-comment">// [esp+208h] [ebp-50h] BYREF</span><br>  __int16 v12; <span class="hljs-comment">// [esp+209h] [ebp-4Fh]</span><br>  <span class="hljs-type">char</span> v13; <span class="hljs-comment">// [esp+20Bh] [ebp-4Dh]</span><br>  <span class="hljs-type">char</span> Str; <span class="hljs-comment">// [esp+214h] [ebp-44h] BYREF</span><br>  <span class="hljs-type">char</span> v15[<span class="hljs-number">49</span>]; <span class="hljs-comment">// [esp+215h] [ebp-43h] BYREF</span><br>  <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [esp+250h] [ebp-8h]</span><br><br>  v16 = <span class="hljs-number">0</span>;<br>  Str = <span class="hljs-number">0</span>;<br>  j_memset(v15, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v15));<br>  Destination = <span class="hljs-number">0</span>;<br>  v12 = <span class="hljs-number">0</span>;<br>  v13 = <span class="hljs-number">0</span>;<br>  v9[<span class="hljs-number">0</span>] = <span class="hljs-number">50</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please Input Your flag:&quot;</span>, v4);<br>  sub_411037(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">char</span>)&amp;Str);<br>  <span class="hljs-keyword">if</span> ( j_strlen(&amp;Str) != <span class="hljs-number">42</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  v8 = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v8 &lt; j_strlen(&amp;Str) )<br>  &#123;<br>    <span class="hljs-built_in">strncpy</span>(&amp;Destination, &amp;Str + v8, <span class="hljs-number">3u</span>);<br>    sub_4113F2((BYTE *)&amp;Destination, <span class="hljs-number">3u</span>, v10, v9);<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( v10[i] != (<span class="hljs-type">unsigned</span> __int8)byte_41A000[<span class="hljs-number">40</span> * v7 + i] )<br>        v16 = <span class="hljs-number">1</span>;<br>    &#125;<br>    v8 += <span class="hljs-number">3</span>;<br>    ++v7;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v16 == <span class="hljs-number">1</span> )<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wrong!!!Please Try Again!!\n&quot;</span>, v5);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Correct!!Your input is flag!!\n&quot;</span>, v5);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>sub_4113F2函数是sha1哈希函数。将明文分成3个字符一组进行加密，每一组和byte_41A000的一部分比较。爆破求解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br><br>data = <span class="hljs-string">&quot;A2F17ED1C6A8BC31769CDF654DF4B8A937042CB600000000000000000000000000000000000000000CA8A2EDB0C1D34A432A5A4464E0D6ABD847C8310000000000000000000000000000000000000000C359D69F3F08BB920F2C3B51133205533462093E0000000000000000000000000000000000000000CC5C3FE6E7356A26A134CFF5633349F597C40A9D00000000000000000000000000000000000000004AC4BB3F27F245BA9178651AA5CDEDCBB2862E2A0000000000000000000000000000000000000000A01E33F4DCDB6BA1AE9F34A97CF8F6DEEEDF1A8D0000000000000000000000000000000000000000D3AF70912A8C1B22CFDECE071BA36BC4662B58FA00000000000000000000000000000000000000009395EAB195D25B676D7D07075D3838A9AC19DF210000000000000000000000000000000000000000FDB43C5EF76ECDA0C1661D6D199B5BFAC1DB538A0000000000000000000000000000000000000000DA8E9997A010BE78B20108CE79FEC1FB9C63D8DC0000000000000000000000000000000000000000809DA627F1AD01D65864C376E3179B62D9D7426100000000000000000000000000000000000000008F61EE21AC7579626934E0FFB6A62B3D4A82EEC40000000000000000000000000000000000000000E2A954758FDB61F869998E9788B7B7E48480B8320000000000000000000000000000000000000000B8E3349B97532B27AA62B8718B68240179158144&quot;</span><br><br>target_hash = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">42</span>//<span class="hljs-number">3</span>):<br>    target_hash.append(data[<span class="hljs-number">80</span>*i:<span class="hljs-number">80</span>*i+<span class="hljs-number">40</span>].lower())<br><br>char_set = ascii_lowercase + ascii_uppercase + digits + <span class="hljs-string">&quot;&#123;_!,.&#125;&quot;</span><br><br><span class="hljs-keyword">for</span> target <span class="hljs-keyword">in</span> target_hash:<br>    <span class="hljs-keyword">for</span> piece <span class="hljs-keyword">in</span> product(*(char_set <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>))):<br>        byte_piece = <span class="hljs-string">&quot;&quot;</span>.join(piece)<br>        <span class="hljs-keyword">if</span> sha1(byte_piece.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)).hexdigest() == target:<br>            <span class="hljs-built_in">print</span>(byte_piece, end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-comment"># flag&#123;Easy_Hash_And_Y0u_Solve_1t_Quickly!!&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="exception"><a class="markdownIt-Anchor" href="#exception"></a> Exception</h3>
<p>IDA反汇编</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main_0</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [esp+0h] [ebp-17Ch]</span><br>  <span class="hljs-type">char</span> v5; <span class="hljs-comment">// [esp+0h] [ebp-17Ch]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+D0h] [ebp-ACh]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+DCh] [ebp-A0h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+E8h] [ebp-94h]</span><br>  <span class="hljs-type">size_t</span> v9; <span class="hljs-comment">// [esp+F4h] [ebp-88h]</span><br>  <span class="hljs-type">char</span> Str; <span class="hljs-comment">// [esp+10Ch] [ebp-70h] BYREF</span><br>  <span class="hljs-type">char</span> v11[<span class="hljs-number">47</span>]; <span class="hljs-comment">// [esp+10Dh] [ebp-6Fh] BYREF</span><br>  <span class="hljs-type">int</span> v12[<span class="hljs-number">6</span>]; <span class="hljs-comment">// [esp+13Ch] [ebp-40h] BYREF</span><br>  <span class="hljs-type">int</span> v13[<span class="hljs-number">9</span>]; <span class="hljs-comment">// [esp+154h] [ebp-28h] BYREF</span><br><br>  v13[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">2</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">5</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">6</span>] = <span class="hljs-number">0</span>;<br>  v13[<span class="hljs-number">7</span>] = <span class="hljs-number">0</span>;<br>  v12[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>  v12[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>;<br>  v12[<span class="hljs-number">2</span>] = <span class="hljs-number">3</span>;<br>  v12[<span class="hljs-number">3</span>] = <span class="hljs-number">4</span>;<br>  Str = <span class="hljs-number">0</span>;<br>  j_memset(v11, <span class="hljs-number">0</span>, <span class="hljs-number">0x27</span>u);<br>  sub_4110E1(<span class="hljs-string">&quot;Please input Your flag:&quot;</span>, v4);<br>  sub_41103C(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">char</span>)&amp;Str);<br>  <span class="hljs-keyword">if</span> ( j_strlen(&amp;Str) != <span class="hljs-number">32</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  v9 = <span class="hljs-number">0</span>;<br>  v8 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v9 &lt; j_strlen(&amp;Str) )<br>  &#123;<br>    v13[v8] = (v11[v9 + <span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">24</span>) | (v11[v9 + <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">16</span>) | (v11[v9] &lt;&lt; <span class="hljs-number">8</span>) | *(&amp;Str + v9);<br>    v9 += <span class="hljs-number">4</span>;<br>    ++v8;<br>  &#125;<br>  sub_41100A((<span class="hljs-type">int</span>)v13, v12);<br>  v7 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( dword_41A000[i] != v13[i] )<br>      v7 = <span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v7 == <span class="hljs-number">1</span> )<br>    sub_4110E1(<span class="hljs-string">&quot;Wrong\n&quot;</span>, v5);<br>  <span class="hljs-keyword">else</span><br>    sub_4110E1(<span class="hljs-string">&quot;Right,flag:flag&#123;%s&#125;\n&quot;</span>, (<span class="hljs-type">char</span>)&amp;Str);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>关键函数sub_41100A。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i += <span class="hljs-number">2</span> )<br>&#123;<br>  v11 = a1[i];<br>  v10 = a1[i + <span class="hljs-number">1</span>];<br>  v9 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; ++j )<br>  &#123;<br>    v9 -= <span class="hljs-number">0x61C88647</span>;<br>    MEMORY[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>    v11 += (v7 + (v10 &gt;&gt; <span class="hljs-number">5</span>)) ^ (v9 + v10) ^ (v8 + <span class="hljs-number">16</span> * v10);<br>    v10 += (v5 + (v11 &gt;&gt; <span class="hljs-number">5</span>)) ^ (v9 + v11) ^ (v6 + <span class="hljs-number">16</span> * v11);<br>  &#125;<br>  a1[i] = v11;<br>  a1[i + <span class="hljs-number">1</span>] = v10;<br>  result = i + <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>tea加密，没有变化。这里这个v9和MEMORY有点问题。看汇编代码。</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>A4 <span class="hljs-comment">;   __try &#123; // __except at loc_4118C9</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>A4                 <span class="hljs-keyword">mov</span>     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>AB                 <span class="hljs-keyword">mov</span>     edx, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>B0                 <span class="hljs-keyword">mov</span>     byte ptr [edx], <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>B0 <span class="hljs-comment">;   &#125; // starts at 4118A4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>B3                 <span class="hljs-keyword">mov</span>     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span>FFFFFFFEh<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BA                 <span class="hljs-keyword">jmp</span>     short loc_4118DE<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BC <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BC<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BC loc_4118BC:                             <span class="hljs-comment">; DATA XREF: .rdata:stru_4191D8↓o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BC <span class="hljs-comment">;   __except filter // owned by 4118A4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BC                 lea     eax, [ebp+var_48]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>BF                 <span class="hljs-keyword">push</span>    eax<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C0                 <span class="hljs-keyword">call</span>    sub_411087<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C5                 <span class="hljs-keyword">add</span>     esp, <span class="hljs-number">4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C8                 retn<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C9 <span class="hljs-comment">; ---------------------------------------------------------------------------</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C9<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C9 loc_4118C9:                             <span class="hljs-comment">; DATA XREF: .rdata:stru_4191D8↓o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C9 <span class="hljs-comment">;   __except(loc_4118BC) // owned by 4118A4</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>C9                 <span class="hljs-keyword">mov</span>     esp, [ebp+ms_exc.old_esp]<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>CC                 <span class="hljs-keyword">mov</span>     eax, var_48<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>CF                 xor     eax, <span class="hljs-number">12345678</span>h<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>D4                 <span class="hljs-keyword">mov</span>     [ebp+var_48], eax<br><span class="hljs-symbol">.text:</span><span class="hljs-number">004118</span>D7                 <span class="hljs-keyword">mov</span>     [ebp+ms_exc.registration.TryLevel], <span class="hljs-number">0</span>FFFFFFFEh<br></code></pre></td></tr></table></figure>
<p>这个必定触发异常，所以一定会进入异常处理，在004118C9处是我们的异常，这里我们将<code>var_48</code>这个值与0x12345678异或了，并且写回。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span>0041188E loc_41188E:                             <span class="hljs-comment">; CODE XREF: sub_411790+ED↑j</span><br><span class="hljs-symbol">.text:</span>0041188E                 <span class="hljs-keyword">cmp</span>     [<span class="hljs-built_in">ebp</span>+var_90], <span class="hljs-number">20h</span> <span class="hljs-comment">; &#x27; &#x27;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">00411895</span>                 <span class="hljs-keyword">jge</span>     loc_411927<br><span class="hljs-symbol">.text:</span>0041189B                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">ebp</span>+var_3C]<br><span class="hljs-symbol">.text:</span>0041189E                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">eax</span>, [<span class="hljs-built_in">ebp</span>+var_48]<br><span class="hljs-symbol">.text:</span>004118A1                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">ebp</span>+var_3C], <span class="hljs-built_in">eax</span><br></code></pre></td></tr></table></figure>
<p><code>var_3C</code>其实是tea里面的sum。这里他与<code>var_48</code>相加，<code>var_48</code>初始值为0x9E3779B9，其实就是我们的delta。</p>
<p>所以这里的加密算法变成了：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">sum += delta;<br>delta ^= <span class="hljs-number">0x12345678</span>;<br>v11 += (v7 + (v10 &gt;&gt; <span class="hljs-number">5</span>)) ^ (v9 + v10) ^ (v8 + <span class="hljs-number">16</span> * v10);<br>v10 += (v5 + (v11 &gt;&gt; <span class="hljs-number">5</span>)) ^ (v9 + v11) ^ (v6 + <span class="hljs-number">16</span> * v11);<br></code></pre></td></tr></table></figure>
<p>所以对应解密即可。得到的结果逆置一下，满足数值变量和字符串的转换。一开始我是以Crypto里面的long_to_bytes转的，但是在C语言里面其实不能这样，也算是踩了一个小坑。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> ctypes <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">v, k</span>):<br>    v0, v1 = c_uint32(v[<span class="hljs-number">0</span>]), c_uint32(v[<span class="hljs-number">1</span>])<br>    delta = <span class="hljs-number">0x9E3779B9</span><br>    k0, k1, k2, k3 = k[<span class="hljs-number">0</span>], k[<span class="hljs-number">1</span>], k[<span class="hljs-number">2</span>], k[<span class="hljs-number">3</span>]<br><br>    total = c_uint32(<span class="hljs-number">2745866144</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        v1.value -= ((v0.value &lt;&lt; <span class="hljs-number">4</span>) + k2) ^ (v0.value + total.value) ^ ((v0.value &gt;&gt; <span class="hljs-number">5</span>) + k3)<br>        v0.value -= ((v1.value &lt;&lt; <span class="hljs-number">4</span>) + k0) ^ (v1.value + total.value) ^ ((v1.value &gt;&gt; <span class="hljs-number">5</span>) + k1)<br>        delta ^= <span class="hljs-number">0x12345678</span><br>        total.value -= delta<br><br>    <span class="hljs-keyword">return</span> v0.value, v1.value<br><br><br><span class="hljs-comment"># test</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    value = [<span class="hljs-number">0x88E821CE</span>, <span class="hljs-number">0x0B009D70</span>, <span class="hljs-number">0x91B1E68F</span>, <span class="hljs-number">0x131EA96</span>, <span class="hljs-number">0x0A3209D7D</span>, <span class="hljs-number">0x0A9187DFB</span>, <span class="hljs-number">0x0C452C5CA</span>, <span class="hljs-number">0x0A9696753</span>]<br>    key = [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x4</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(value) // <span class="hljs-number">2</span>):<br>        res = decrypt(value[<span class="hljs-number">2</span> * i:<span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>], key)<br>        <span class="hljs-built_in">print</span>(long_to_bytes(res[<span class="hljs-number">0</span>]).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[::-<span class="hljs-number">1</span>] + long_to_bytes(res[<span class="hljs-number">1</span>]).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[::-<span class="hljs-number">1</span>], end=<span class="hljs-string">&quot;&quot;</span>)<br>        <br><span class="hljs-comment"># 44C3A7F112DA2BE728F451C5E2D09558</span><br><span class="hljs-comment"># flag&#123;44C3A7F112DA2BE728F451C5E2D09558&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="拔丝溜肆-easy"><a class="markdownIt-Anchor" href="#拔丝溜肆-easy"></a> 拔丝溜肆 (easy)</h3>
<p>通过字符串来找主要的函数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 <span class="hljs-title function_">sub_140011CF0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *v0; <span class="hljs-comment">// rdi</span><br>  __int64 i; <span class="hljs-comment">// rcx</span><br>  <span class="hljs-type">char</span> v3[<span class="hljs-number">32</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-20h] BYREF</span><br>  <span class="hljs-type">char</span> v4; <span class="hljs-comment">// [rsp+20h] [rbp+0h] BYREF</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">88</span>]; <span class="hljs-comment">// [rsp+28h] [rbp+8h] BYREF</span><br>  <span class="hljs-type">char</span> Str1[<span class="hljs-number">104</span>]; <span class="hljs-comment">// [rsp+80h] [rbp+60h] BYREF</span><br>  <span class="hljs-type">char</span> Str2[<span class="hljs-number">57</span>]; <span class="hljs-comment">// [rsp+E8h] [rbp+C8h] BYREF</span><br>  <span class="hljs-type">char</span> v8[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [rsp+121h] [rbp+101h] BYREF</span><br><br>  v0 = &amp;v4;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">72</span>i64; i; --i )<br>  &#123;<br>    *(_DWORD *)v0 = <span class="hljs-number">0xCCCCCCCC</span>;<br>    v0 += <span class="hljs-number">4</span>;<br>  &#125;<br>  sub_14001137F((__int64)&amp;unk_140023014);<br>  srand(<span class="hljs-number">0x1BF52</span>u);<br>  <span class="hljs-built_in">memset</span>(Str, <span class="hljs-number">0</span>, <span class="hljs-number">0x32</span>ui64);<br>  <span class="hljs-built_in">memset</span>(Str1, <span class="hljs-number">0</span>, <span class="hljs-number">0x50</span>ui64);<br>  <span class="hljs-built_in">strcpy</span>(Str2, <span class="hljs-string">&quot;CPaKBfUZFcNwW9qCKgyvuS2PGPQ9mttGc/wCNS0w6hDwGOSsOkOEkL5V&quot;</span>);<br>  <span class="hljs-built_in">memset</span>(v8, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v8));<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Congratulations on making it to the end and enjoying the game\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input Your flag:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, Str);<br>  <span class="hljs-keyword">if</span> ( j_strlen(Str) != <span class="hljs-number">42</span> )<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  sub_140011069((__int64)Str, (__int64)Str1);<br>  <span class="hljs-keyword">if</span> ( !j_strcmp(Str1, Str2) )<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Right!!!\n&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Wrong!!!\n&quot;</span>);<br>  sub_14001131B(v3, &amp;unk_14001ACC8);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>i64;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>长度要求42，关键函数sub_140011069指向sub_1400118B0。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64 __fastcall <span class="hljs-title function_">sub_1400118B0</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *input, __int64 output)</span><br>&#123;<br>  __int64 v2; <span class="hljs-comment">// rcx</span><br>  __int64 v3; <span class="hljs-comment">// rdx</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [rsp+64h] [rbp+44h]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [rsp+84h] [rbp+64h]</span><br><br>  sub_14001137F((__int64)&amp;unk_140023014);<br>  v5 = j_strlen(input);<br>  v3 = (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)(v5 &gt;&gt; <span class="hljs-number">31</span>);<br>  v2 = <span class="hljs-number">3</span>i64;<br>  LODWORD(v3) = v5 % <span class="hljs-number">3</span>;<br>  v6 = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( v6 &lt; v5 )<br>  &#123;<br>    sub_14001127B(v2, v3);<br>    *(_BYTE *)(output + v7) = byte_14001E1C0[input[v6] &gt;&gt; <span class="hljs-number">2</span>];<br>    *(_BYTE *)(output + v7 + <span class="hljs-number">1</span>) = byte_14001E1C0[((input[v6 + <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF0</span>) &gt;&gt; <span class="hljs-number">4</span>) | (<span class="hljs-number">16</span> * (input[v6] &amp; <span class="hljs-number">3</span>))];<br>    *(_BYTE *)(output + v7 + <span class="hljs-number">2</span>) = byte_14001E1C0[((input[v6 + <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xC0</span>) &gt;&gt; <span class="hljs-number">6</span>) | (<span class="hljs-number">4</span> * (input[v6 + <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xF</span>))];<br>    v2 = (__int64)byte_14001E1C0;<br>    v3 = v7 + <span class="hljs-number">3</span>;<br>    *(_BYTE *)(output + v3) = byte_14001E1C0[input[v6 + <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0x3F</span>];<br>    v6 += <span class="hljs-number">3</span>;<br>    v7 += <span class="hljs-number">4</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span> ( v5 % <span class="hljs-number">3</span> == <span class="hljs-number">1</span> )<br>  &#123;<br>    *(_BYTE *)(output + v7 - <span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;<br>    *(_BYTE *)(output + v7 - <span class="hljs-number">2</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( v5 % <span class="hljs-number">3</span> == <span class="hljs-number">2</span> )<br>  &#123;<br>    *(_BYTE *)(output + v7 - <span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;=&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> output;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>很明显是一个base64的编码算法。看看sub_14001127B。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">size_t</span> <span class="hljs-title function_">sub_1400117E0</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">size_t</span> result; <span class="hljs-comment">// rax</span><br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// [rsp+24h] [rbp+4h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+44h] [rbp+24h]</span><br><br>  sub_14001137F((__int64)&amp;unk_140023014);<br>  v1 = rand() % <span class="hljs-number">64</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; ; ++i )<br>  &#123;<br>    result = j_strlen(Str);<br>    <span class="hljs-keyword">if</span> ( i &gt;= result )<br>      <span class="hljs-keyword">break</span>;<br>    byte_14001E1C0[i] = Str[(v1 + i) % <span class="hljs-number">64</span>];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>这里的Str和主函数的不是一个。看了一下是初始的base64码表，所以这个函数实际上是生成一个新的码表。这里的rand可预测。</p>
<p>所以整体就是每三个明文使用一个base64码表编码。逆过来即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> *<br><br>random_list = [<span class="hljs-number">13545</span>, <span class="hljs-number">19112</span>, <span class="hljs-number">12729</span>, <span class="hljs-number">29322</span>, <span class="hljs-number">16702</span>, <span class="hljs-number">2078</span>, <span class="hljs-number">10043</span>, <span class="hljs-number">2201</span>, <span class="hljs-number">6796</span>, <span class="hljs-number">11264</span>, <span class="hljs-number">9582</span>, <span class="hljs-number">25786</span>, <span class="hljs-number">17729</span>, <span class="hljs-number">9432</span>, <span class="hljs-number">11586</span>,<br>               <span class="hljs-number">24167</span>, <span class="hljs-number">27649</span>, <span class="hljs-number">8072</span>, <span class="hljs-number">29092</span>, <span class="hljs-number">28713</span>, <span class="hljs-number">9533</span>, <span class="hljs-number">1675</span>, <span class="hljs-number">27056</span>, <span class="hljs-number">20736</span>, <span class="hljs-number">14087</span>, <span class="hljs-number">1663</span>, <span class="hljs-number">21282</span>, <span class="hljs-number">15621</span>, <span class="hljs-number">19748</span>, <span class="hljs-number">15328</span>,<br>               <span class="hljs-number">14606</span>, <span class="hljs-number">12622</span>, <span class="hljs-number">21859</span>, <span class="hljs-number">28183</span>, <span class="hljs-number">21202</span>, <span class="hljs-number">7954</span>, <span class="hljs-number">30254</span>, <span class="hljs-number">31667</span>, <span class="hljs-number">20296</span>, <span class="hljs-number">23053</span>, <span class="hljs-number">21343</span>, <span class="hljs-number">23542</span>, <span class="hljs-number">24640</span>, <span class="hljs-number">17958</span>, <span class="hljs-number">5461</span>,<br>               <span class="hljs-number">22931</span>, <span class="hljs-number">6701</span>, <span class="hljs-number">2128</span>, <span class="hljs-number">26182</span>, <span class="hljs-number">27318</span>]<br><br>origin_str = <span class="hljs-string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_new_base64_table</span>(<span class="hljs-params">random_num, origin_str</span>):<br>    inc = random_num % <span class="hljs-number">64</span><br>    new_str = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(origin_str)):<br>        new_str += origin_str[(inc + i) % <span class="hljs-number">64</span>]<br><br>    <span class="hljs-keyword">return</span> new_str<br><br><span class="hljs-comment"># 由于给的密文没有=，这里没有写pad的相关部分。</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base64encode</span>(<span class="hljs-params">data, table</span>):<br>    bin_data = s2b(data)<br><br>    res = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(bin_data)//<span class="hljs-number">6</span>):<br>        index = <span class="hljs-built_in">int</span>(bin_data[<span class="hljs-number">6</span>*i:<span class="hljs-number">6</span>*i+<span class="hljs-number">6</span>], <span class="hljs-number">2</span>)<br>        res += table[index]<br><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">base64decode</span>(<span class="hljs-params">data, table:<span class="hljs-built_in">str</span></span>):<br>    bin_res = <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> data:<br>        bin_res += <span class="hljs-built_in">bin</span>(table.index(i))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>)<br><br>    <span class="hljs-keyword">return</span> b2s(bin_res)<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br><br>    cipher = <span class="hljs-string">&quot;CPaKBfUZFcNwW9qCKgyvuS2PGPQ9mttGc/wCNS0w6hDwGOSsOkOEkL5V&quot;</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)//<span class="hljs-number">4</span>):<br>        table = generate_new_base64_table(random_list[i], origin_str)<br>        data = cipher[<span class="hljs-number">4</span>*i:<span class="hljs-number">4</span>*i+<span class="hljs-number">4</span>]<br>        <span class="hljs-built_in">print</span>(base64decode(data, table).decode(<span class="hljs-string">&quot;utf-8&quot;</span>), end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-comment"># flag&#123;12573882-1CF1-EB5E-C965-035B1F263C38&#125;</span><br></code></pre></td></tr></table></figure>
<h3 id="e4sy_mix-hard"><a class="markdownIt-Anchor" href="#e4sy_mix-hard"></a> E4sy_Mix (hard)</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// ebp</span><br>  _BYTE *v4; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">char</span> *v8; <span class="hljs-comment">// eax</span><br>  _OWORD v10[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [esp-40h] [ebp-4Ch] BYREF</span><br>  <span class="hljs-type">char</span> v11; <span class="hljs-comment">// [esp-20h] [ebp-2Ch]</span><br>  <span class="hljs-type">char</span> v12; <span class="hljs-comment">// [esp-8h] [ebp-14h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp-4h] [ebp-10h]</span><br>  _DWORD v14[<span class="hljs-number">3</span>]; <span class="hljs-comment">// [esp+0h] [ebp-Ch] BYREF</span><br>  <span class="hljs-type">void</span> *retaddr; <span class="hljs-comment">// [esp+Ch] [ebp+0h]</span><br><br>  v14[<span class="hljs-number">0</span>] = v3;<br>  v14[<span class="hljs-number">1</span>] = retaddr;<br>  v11 = <span class="hljs-number">0</span>;<br>  v10[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>i64;<br>  v10[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>i64;<br>  sub_401020(<span class="hljs-string">&quot;Please input your flag:&quot;</span>, <span class="hljs-number">0</span>);<br>  sub_401050(<span class="hljs-string">&quot;%s&quot;</span>, (<span class="hljs-type">char</span>)v10);<br>  v4 = &amp;loc_402000;<br>  v5 = <span class="hljs-number">53</span>;<br>  <span class="hljs-keyword">do</span><br>  &#123;<br>    *v4++ ^= <span class="hljs-number">0x54</span>u;<br>    --v5;<br>  &#125;<br>  <span class="hljs-keyword">while</span> ( v5 );<br>  ((<span class="hljs-type">void</span> (__stdcall *)(_OWORD *))loc_402000)(v10);<br>  v6 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">while</span> ( byte_4030FC[v6] == *((_BYTE *)v10 + v6) )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( ++v6 &gt;= <span class="hljs-number">33</span> )<br>    &#123;<br>      v7 = <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">goto</span> LABEL_8;<br>    &#125;<br>  &#125;<br>  v7 = <span class="hljs-number">0</span>;<br>LABEL_8:<br>  v8 = <span class="hljs-string">&quot;Your input is Wrong! Try again!\n&quot;</span>;<br>  <span class="hljs-keyword">if</span> ( v7 )<br>    v8 = <span class="hljs-string">&quot;Your input is flag!!\n&quot;</span>;<br>  sub_401020(v8, v12);<br>  <span class="hljs-keyword">return</span> sub_401286((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>)v14 ^ v13);<br>&#125;<br></code></pre></td></tr></table></figure>
<p>中间的函数调用出了点问题。看到上面的while循环有一个异或操作。其实就是把代码段的那段数据异或一下，得到的才是真正要执行的代码。所以我们提取出来手动修正一下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> ( v5 );<br>sub_402000((<span class="hljs-type">int</span>)v10);<br>v6 = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span> ( byte_4030FC[v6] == *((_BYTE *)v10 + v6) )<br></code></pre></td></tr></table></figure>
<p>完成后，函数可以正常的反汇编。</p>
<p>关键处理函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">char</span> __cdecl <span class="hljs-title function_">sub_401080</span><span class="hljs-params">(<span class="hljs-type">int</span> a1, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> a2)</span><br>&#123;<br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// ecx</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> j; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">char</span> result; <span class="hljs-comment">// al</span><br><br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; ++i )<br>  &#123;<br>    byte_404490[i] = i;<br>    byte_404390[i] = byte_404018[i % a2];<br>  &#125;<br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">256</span>; ++j )<br>  &#123;<br>    v5 = byte_404490[j];<br>    v3 = (v5 + (<span class="hljs-type">unsigned</span> __int8)byte_404390[j] + v3) % <span class="hljs-number">256</span>;<br>    result = byte_404490[v3];<br>    byte_404490[j] = result;<br>    byte_404490[v3] = v5;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> __usercall sub_401110@&lt;eax&gt;(<span class="hljs-type">int</span> a1@&lt;edx&gt;, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *a2)<br>&#123;<br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v3; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> v4; <span class="hljs-comment">// ebx</span><br>  <span class="hljs-type">unsigned</span> __int8 v5; <span class="hljs-comment">// dl</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+10h] [ebp-4h]</span><br><br>  result = <span class="hljs-built_in">strlen</span>(a2);<br>  v3 = <span class="hljs-number">0</span>;<br>  v4 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; result; ++i )<br>  &#123;<br>    v3 = (v3 + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span>;<br>    v5 = byte_404490[v3];<br>    v4 = (v5 + v4) % <span class="hljs-number">256</span>;<br>    byte_404490[v3] = byte_404490[v4];<br>    byte_404490[v4] = v5;<br>    *(_BYTE *)(i + a1) ^= byte_404490[(<span class="hljs-type">unsigned</span> __int8)(v5 + byte_404490[v3])];<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>由于我们的数据只在最后这个异或进行加密。所以直接dump关键数据出来处理即可。</p>
<p>这里我把ecx寄存器的值dump出来。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">target_data = <span class="hljs-built_in">bytes</span>(<br>    [<span class="hljs-number">0xA1</span>, <span class="hljs-number">0xBF</span>, <span class="hljs-number">0xB6</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0xDB</span>,<br>     <span class="hljs-number">0x41</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0xFC</span>])<br><br><br>xor_data = [<span class="hljs-number">0xc7</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x9</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0xab</span>, <span class="hljs-number">0xf0</span>, <span class="hljs-number">0xef</span>, <span class="hljs-number">0xc0</span>, <span class="hljs-number">0xe2</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x1e</span>, <span class="hljs-number">0xc5</span>,<br>            <span class="hljs-number">0x04</span>, <span class="hljs-number">0xe5</span>, <span class="hljs-number">0xa8</span>, <span class="hljs-number">0x1e</span>, <span class="hljs-number">0x72</span>, <span class="hljs-number">0x1d</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xb4</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xd7</span>, <span class="hljs-number">0xac</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x7f</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x63</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(xor_data)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(xor_data[i] ^ target_data[i]), end=<span class="hljs-string">&quot;&quot;</span>)<br>    <br><span class="hljs-comment"># flag&#123;RC4_and_SMC_is_interesting!</span><br><span class="hljs-comment"># flag&#123;RC4_and_SMC_is_interesting!&#125;</span><br></code></pre></td></tr></table></figure>
<p>看了flag才知道是RC4和SMC，我自己复现算法来解这题完全行不通，我也不知道为啥。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/CTF/">CTF</a>
                    
                      <a class="hover-with-bg" href="/tags/writeup/">writeup</a>
                    
                      <a class="hover-with-bg" href="/tags/Crypto/">Crypto</a>
                    
                      <a class="hover-with-bg" href="/tags/Reverse/">Reverse</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/09/BuckeyeCTF-2022/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">BuckeyeCTF 2022</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/12/Playfair-Crack/">
                        <span class="hidden-mobile">Playfair Cracker</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- KaTeX -->
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css" />
  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
